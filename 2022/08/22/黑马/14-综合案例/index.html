<!DOCTYPE html>
<html lang=en>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>FinalCase | Bonjour!</title>
  <meta name="description" content="总结  综合案例 今日目标：   能够完成查询所有功能 能够完成添加功能 能够理解 BaseServlet 思想 能够完成批量删除功能 能够完成分页查询功能 能够完成条件查询功能    1，功能介绍  以上是我们在综合案例要实现的功能。对数据的除了对数据的增删改查功能外，还有一些复杂的功能，如 批量删除、分页查询、条件查询 等功能  批量删除 功能：每条数据前都有复选框，当我选中多条数据并点击">
<meta property="og:type" content="article">
<meta property="og:title" content="FinalCase">
<meta property="og:url" content="http://littlewuuu.com/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/index.html">
<meta property="og:site_name" content="hexo">
<meta property="og:description" content="总结  综合案例 今日目标：   能够完成查询所有功能 能够完成添加功能 能够理解 BaseServlet 思想 能够完成批量删除功能 能够完成分页查询功能 能够完成条件查询功能    1，功能介绍  以上是我们在综合案例要实现的功能。对数据的除了对数据的增删改查功能外，还有一些复杂的功能，如 批量删除、分页查询、条件查询 等功能  批量删除 功能：每条数据前都有复选框，当我选中多条数据并点击">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://littlewuuu.com/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/assets/image-20210825171411003.png">
<meta property="og:image" content="http://littlewuuu.com/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/assets/image-20210825195522904.png">
<meta property="og:image" content="http://littlewuuu.com/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/assets/image-20210825200138600.png">
<meta property="og:image" content="http://littlewuuu.com/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/assets/image-20210825201634849.png">
<meta property="og:image" content="http://littlewuuu.com/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/image-20210825200332542.png">
<meta property="og:image" content="http://littlewuuu.com/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/assets/image-20210825203843142.png">
<meta property="og:image" content="http://littlewuuu.com/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/assets/image-20210825205133752.png">
<meta property="og:image" content="http://littlewuuu.com/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/assets/image-20210825220436889.png">
<meta property="og:image" content="http://littlewuuu.com/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/assets/image-20210825221138245.png">
<meta property="og:image" content="http://littlewuuu.com/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/assets/image-20210825221329231.png">
<meta property="og:image" content="http://littlewuuu.com/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/assets/image-20210826185917510.png">
<meta property="og:image" content="http://littlewuuu.com/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/assets/image-20210825223121993.png">
<meta property="og:image" content="http://littlewuuu.com/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/assets/image-20210825223933953.png">
<meta property="og:image" content="http://littlewuuu.com/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/assets/image-20210825224958220.png">
<meta property="og:image" content="http://littlewuuu.com/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/assets/image-20210826184103210.png">
<meta property="og:image" content="http://littlewuuu.com/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/assets/image-20210826185420668.png">
<meta property="og:image" content="http://littlewuuu.com/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/assets/image-20210826201651241.png">
<meta property="og:image" content="http://littlewuuu.com/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/assets/image-20210826223103884.png">
<meta property="og:image" content="http://littlewuuu.com/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/assets/image-20210826223750518.png">
<meta property="og:image" content="http://littlewuuu.com/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/assets/image-20210826224121445.png">
<meta property="og:image" content="http://littlewuuu.com/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/assets/image-20210826225742852.png">
<meta property="og:image" content="http://littlewuuu.com/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/assets/image-20210826230648031.png">
<meta property="og:image" content="http://littlewuuu.com/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/assets/image-20210826231842293.png">
<meta property="og:image" content="http://littlewuuu.com/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/assets/image-20210826232158234.png">
<meta property="og:image" content="http://littlewuuu.com/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/assets/image-20210826232620404.png">
<meta property="og:image" content="http://littlewuuu.com/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/assets/image-20210828184610060.png">
<meta property="og:image" content="http://littlewuuu.com/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/assets/image-20210828185553407.png">
<meta property="og:image" content="http://littlewuuu.com/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/assets/image-20210828191752872.png">
<meta property="og:image" content="http://littlewuuu.com/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/assets/image-20210828192937340.png">
<meta property="og:image" content="http://littlewuuu.com/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/assets/image-20210828193143116.png">
<meta property="og:image" content="http://littlewuuu.com/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/assets/image-20210828193713913.png">
<meta property="og:image" content="http://littlewuuu.com/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/assets/image-20210828212019663.png">
<meta property="og:image" content="http://littlewuuu.com/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/assets/image-20210828213116559.png">
<meta property="og:image" content="http://littlewuuu.com/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/assets/image-20210828224859135.png">
<meta property="og:image" content="http://littlewuuu.com/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/assets/image-20210828223817324.png">
<meta property="og:image" content="http://littlewuuu.com/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/assets/image-20210828223952142.png">
<meta property="article:published_time" content="2022-08-21T22:00:00.000Z">
<meta property="article:modified_time" content="2022-12-01T18:17:59.536Z">
<meta property="article:author" content="Zilong WU">
<meta property="article:tag" content="JavaWeb">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://littlewuuu.com/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/assets/image-20210825171411003.png">
  <!-- Canonical links -->
  <link rel="canonical" href="http://littlewuuu.com/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/index.html">
  
    <link rel="alternate" href="/atom.xml" title="hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/source/favicon1.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
    <link href="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.3.5/dist/jquery.fancybox.min.css" rel="stylesheet">
  
  
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.0.0"></head>


<body class="main-center theme-white no-sidebar" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://github.com/littlewuuu" target="_blank">
          <img class="img-circle img-rotate" src="/images/meee.jpg" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">Wuuu</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md"></h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Nantes, France</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="Search" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="Type something..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav menu-highlight">
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">Archives</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">Categories</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-links">
          <a href="/links">
            
            <i class="icon icon-friendship"></i>
            
            <span class="menu-title">Links</span>
          </a>
        </li>
        
      </ul>
      
    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">Board</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">Categories</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/COURS/">COURS</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Case/">Case</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Painting/">Painting</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SKILLS/">SKILLS</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SQL/">SQL</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/le-francais/">le français</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%81%9A%E9%A5%AD%E5%8C%BA/">做饭区</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%94%9F%E6%B4%BB/">生活</a><span class="category-list-count">3</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Tags</h3>
    <div class="widget-body">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ECN/" rel="tag">ECN</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaJDBC/" rel="tag">JavaJDBC</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaNotes/" rel="tag">JavaNotes</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaWeb/" rel="tag">JavaWeb</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Marker/" rel="tag">Marker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Procreate/" rel="tag">Procreate</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQL/" rel="tag">SQL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringBootVueOneDay/" rel="tag">SpringBootVueOneDay</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/le-francais/" rel="tag">le français</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%80%E4%BA%9B%E5%A5%87%E5%A5%87%E6%80%AA%E6%80%AA%E7%9A%84%E5%90%83%E7%9A%84/" rel="tag">一些奇奇怪怪的吃的</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%B8%80%E4%BA%9B%E6%AD%A3%E6%AD%A3%E7%BB%8F%E7%BB%8F%E7%9A%84%E5%90%83%E7%9A%84/" rel="tag">一些正正经经的吃的</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%88%B0%E5%A4%84%E7%8E%A9/" rel="tag">到处玩</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%A5%BD%E5%A5%BD%E7%94%9F%E6%B4%BB/" rel="tag">好好生活</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%A6%E4%BA%86%E5%8F%88%E5%BF%98%E7%9A%84%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB/" rel="tag">学了又忘的杂七杂八</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9C%89%E7%82%B9%E9%9A%BE%E5%AD%A6%E7%9A%84/" rel="tag">有点难学的</a><span class="tag-list-count">2</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Archive</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">December 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">October 2022</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">September 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>


    
  </div>
</aside>

  
  
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <nav id="toc" class="article-toc">
      <h3 class="toc-title">Catalogue</h3>
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.</span> <span class="toc-text"> 总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B"><span class="toc-number">2.</span> <span class="toc-text"> 综合案例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E5%8A%9F%E8%83%BD%E4%BB%8B%E7%BB%8D"><span class="toc-number">3.</span> <span class="toc-text"> 1，功能介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">4.</span> <span class="toc-text"> 2，环境准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#21-%E5%B7%A5%E7%A8%8B%E5%87%86%E5%A4%87"><span class="toc-number">4.1.</span> <span class="toc-text"> 2.1  工程准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-%E5%88%9B%E5%BB%BA%E8%A1%A8"><span class="toc-number">4.2.</span> <span class="toc-text"> 2.2  创建表</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E6%9F%A5%E8%AF%A2%E6%89%80%E6%9C%89%E5%8A%9F%E8%83%BD"><span class="toc-number">5.</span> <span class="toc-text"> 3，查询所有功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#31-%E5%90%8E%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="toc-number">5.1.</span> <span class="toc-text"> 3.1 后端实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#311-dao%E6%96%B9%E6%B3%95%E5%AE%9E%E7%8E%B0"><span class="toc-number">5.1.1.</span> <span class="toc-text"> 3.1.1  dao方法实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#312-service%E6%96%B9%E6%B3%95%E5%AE%9E%E7%8E%B0"><span class="toc-number">5.1.2.</span> <span class="toc-text"> 3.1.2  service方法实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#313-servlet%E5%AE%9E%E7%8E%B0"><span class="toc-number">5.1.3.</span> <span class="toc-text"> 3.1.3  servlet实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#314-%E6%B5%8B%E8%AF%95%E5%90%8E%E7%AB%AF%E7%A8%8B%E5%BA%8F"><span class="toc-number">5.1.4.</span> <span class="toc-text"> 3.1.4  测试后端程序</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#32-%E5%89%8D%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="toc-number">5.2.</span> <span class="toc-text"> 3.2  前端实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E6%B7%BB%E5%8A%A0%E5%8A%9F%E8%83%BD"><span class="toc-number">6.</span> <span class="toc-text"> 4，添加功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#41-%E5%90%8E%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="toc-number">6.1.</span> <span class="toc-text"> 4.1  后端实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#411-dao%E6%96%B9%E6%B3%95%E5%AE%9E%E7%8E%B0"><span class="toc-number">6.1.1.</span> <span class="toc-text"> 4.1.1  dao方法实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#412-service%E6%96%B9%E6%B3%95%E5%AE%9E%E7%8E%B0"><span class="toc-number">6.1.2.</span> <span class="toc-text"> 4.1.2  service方法实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#413-servlet%E5%AE%9E%E7%8E%B0"><span class="toc-number">6.1.3.</span> <span class="toc-text"> 4.1.3  servlet实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#42-%E5%89%8D%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="toc-number">6.2.</span> <span class="toc-text"> 4.2  前端实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5servlet%E4%BC%98%E5%8C%96"><span class="toc-number">7.</span> <span class="toc-text"> 5，servlet优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#51-%E9%97%AE%E9%A2%98%E5%AF%BC%E5%85%A5"><span class="toc-number">7.1.</span> <span class="toc-text"> 5.1  问题导入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#52-%E4%BB%A3%E7%A0%81%E4%BC%98%E5%8C%96"><span class="toc-number">7.2.</span> <span class="toc-text"> 5.2  代码优化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#521-%E5%90%8E%E7%AB%AF%E4%BC%98%E5%8C%96"><span class="toc-number">7.2.1.</span> <span class="toc-text"> 5.2.1  后端优化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#522-%E5%89%8D%E7%AB%AF%E4%BC%98%E5%8C%96"><span class="toc-number">7.2.2.</span> <span class="toc-text"> 5.2.2  前端优化</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4"><span class="toc-number">8.</span> <span class="toc-text"> 6，批量删除</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#61-%E5%90%8E%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="toc-number">8.1.</span> <span class="toc-text"> 6.1  后端实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#611-dao%E6%96%B9%E6%B3%95%E5%AE%9E%E7%8E%B0"><span class="toc-number">8.1.1.</span> <span class="toc-text"> 6.1.1  dao方法实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#612-service%E6%96%B9%E6%B3%95%E5%AE%9E%E7%8E%B0"><span class="toc-number">8.1.2.</span> <span class="toc-text"> 6.1.2  service方法实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#613-servlet%E5%AE%9E%E7%8E%B0"><span class="toc-number">8.1.3.</span> <span class="toc-text"> 6.1.3  servlet实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#62-%E5%89%8D%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="toc-number">8.2.</span> <span class="toc-text"> 6.2  前端实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#621-%E8%8E%B7%E5%8F%96%E9%80%89%E4%B8%AD%E7%9A%84id%E5%80%BC"><span class="toc-number">8.2.1.</span> <span class="toc-text"> 6.2.1  获取选中的id值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#622-%E5%8F%91%E9%80%81%E5%BC%82%E6%AD%A5%E8%AF%B7%E6%B1%82"><span class="toc-number">8.2.2.</span> <span class="toc-text"> 6.2.2  发送异步请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#623-%E7%A1%AE%E5%AE%9A%E6%A1%86%E5%AE%9E%E7%8E%B0"><span class="toc-number">8.2.3.</span> <span class="toc-text"> 6.2.3  确定框实现</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">9.</span> <span class="toc-text"> 7，分页查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#71-%E5%88%86%E6%9E%90"><span class="toc-number">9.1.</span> <span class="toc-text"> 7.1  分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#711-%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2sql"><span class="toc-number">9.1.1.</span> <span class="toc-text"> 7.1.1  分页查询sql</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#712-%E5%89%8D%E5%90%8E%E7%AB%AF%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90"><span class="toc-number">9.1.2.</span> <span class="toc-text"> 7.1.2  前后端数据分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#713-%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90"><span class="toc-number">9.1.3.</span> <span class="toc-text"> 7.1.3  流程分析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#72-%E5%90%8E%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="toc-number">9.2.</span> <span class="toc-text"> 7.2  后端实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#721-dao%E6%96%B9%E6%B3%95%E5%AE%9E%E7%8E%B0"><span class="toc-number">9.2.1.</span> <span class="toc-text"> 7.2.1  dao方法实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#722-service%E6%96%B9%E6%B3%95%E5%AE%9E%E7%8E%B0"><span class="toc-number">9.2.2.</span> <span class="toc-text"> 7.2.2  service方法实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#723-servlet%E5%AE%9E%E7%8E%B0"><span class="toc-number">9.2.3.</span> <span class="toc-text"> 7.2.3  servlet实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#724-%E6%B5%8B%E8%AF%95"><span class="toc-number">9.2.4.</span> <span class="toc-text"> 7.2.4  测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#73-%E5%89%8D%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="toc-number">9.3.</span> <span class="toc-text"> 7.3  前端实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#731-selectall-%E4%BB%A3%E7%A0%81%E6%94%B9%E8%BF%9B"><span class="toc-number">9.3.1.</span> <span class="toc-text"> 7.3.1  selectAll 代码改进</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#732-%E6%94%B9%E5%8F%98%E6%AF%8F%E9%A1%B5%E6%9D%A1%E7%9B%AE%E6%95%B0"><span class="toc-number">9.3.2.</span> <span class="toc-text"> 7.3.2  改变每页条目数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#733-%E6%94%B9%E5%8F%98%E5%BD%93%E5%89%8D%E9%A1%B5%E7%A0%81"><span class="toc-number">9.3.3.</span> <span class="toc-text"> 7.3.3  改变当前页码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2"><span class="toc-number">10.</span> <span class="toc-text"> 8，条件查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#81-%E5%90%8E%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="toc-number">10.1.</span> <span class="toc-text"> 8.1  后端实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#811-dao%E5%AE%9E%E7%8E%B0"><span class="toc-number">10.1.1.</span> <span class="toc-text"> 8.1.1  dao实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#812-service%E5%AE%9E%E7%8E%B0"><span class="toc-number">10.1.2.</span> <span class="toc-text"> 8.1.2  service实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#813-servlet%E5%AE%9E%E7%8E%B0"><span class="toc-number">10.1.3.</span> <span class="toc-text"> 8.1.3  servlet实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#82-%E5%89%8D%E7%AB%AF%E5%AE%9E%E7%8E%B0"><span class="toc-number">10.2.</span> <span class="toc-text"> 8.2  前端实现</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9%E5%89%8D%E7%AB%AF%E4%BB%A3%E7%A0%81%E4%BC%98%E5%8C%96"><span class="toc-number">11.</span> <span class="toc-text"> 9，前端代码优化</span></a></li></ol>
    </nav>
  </div>
</aside>

<main class="main" role="main">
  <div class="content">
  <article id="post-黑马/14-综合案例" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      FinalCase
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/" class="article-date">
	  <time datetime="2022-08-21T22:00:00.000Z" itemprop="datePublished">2022-08-22</time>
	</a>
</span>
        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/Java/">Java</a>
  </span>

        
  <span class="article-tag">
    <i class="icon icon-tags"></i>
	<a class="article-tag-link-link" href="/tags/JavaWeb/" rel="tag">JavaWeb</a>
  </span>


        

        <span class="post-comment"><i class="icon icon-comment"></i> <a href="/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/#comments" class="article-comment-link">Comments</a></span>
        
	
		<span class="post-wordcount hidden-xs" itemprop="wordCount">Word Count: 11k(words)</span>
	
	
		<span class="post-readcount hidden-xs" itemprop="timeRequired">Read Count: 46(minutes)</span>
	

      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <h2 id="总结"><a class="markdownIt-Anchor" href="#总结"></a> 总结</h2>
<h2 id="综合案例"><a class="markdownIt-Anchor" href="#综合案例"></a> 综合案例</h2>
<p><strong>今日目标：</strong></p>
<blockquote>
<ul>
<li>能够完成查询所有功能</li>
<li>能够完成添加功能</li>
<li>能够理解 BaseServlet 思想</li>
<li>能够完成批量删除功能</li>
<li>能够完成分页查询功能</li>
<li>能够完成条件查询功能</li>
</ul>
</blockquote>
<h2 id="1功能介绍"><a class="markdownIt-Anchor" href="#1功能介绍"></a> 1，功能介绍</h2>
<p><img src="assets/image-20210825171411003.png" alt="image-20210825171411003" /></p>
<p>以上是我们在综合案例要实现的功能。对数据的除了对数据的增删改查功能外，还有一些复杂的功能，如 <code>批量删除</code>、<code>分页查询</code>、<code>条件查询</code> 等功能</p>
<ul>
<li><code>批量删除</code> 功能：每条数据前都有复选框，当我选中多条数据并点击 <code>批量删除</code> 按钮后，会发送请求到后端并删除数据库中指定的多条数据。</li>
<li><code>分页查询</code> 功能：当数据库中有很多数据时，我们不可能将所有的数据展示在一页里，这个时候就需要分页展示数据。</li>
<li><code>条件查询</code> 功能：数据库量大的时候，我们就需要精确的查询一些想看到的数据，这个时候就需要通过条件查询。</li>
</ul>
<p>这里的 <code>修改品牌</code> 和 <code>删除品牌</code> 功能在课程上不做讲解，留作同学来下的练习。</p>
<h2 id="2环境准备"><a class="markdownIt-Anchor" href="#2环境准备"></a> 2，环境准备</h2>
<p>环境准备我们主要完成以下两件事即可</p>
<ul>
<li>将资料的 brand-case 模块导入到 idea中</li>
<li>执行资料中提供的 tb_brand.sql脚本</li>
</ul>
<h3 id="21-工程准备"><a class="markdownIt-Anchor" href="#21-工程准备"></a> 2.1  工程准备</h3>
<p>将 <code>04-资料\01-初始工程</code> 中的 <code>brand-case</code> 工程导入到我们自己的 idea 中。工程结构如下：</p>
<img src="assets/image-20210825195522904.png" alt="image-20210825195522904" style="zoom:80%;" />
<h3 id="22-创建表"><a class="markdownIt-Anchor" href="#22-创建表"></a> 2.2  创建表</h3>
<p>下面是创建表的语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 删除tb_brand表</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> tb_brand;</span><br><span class="line"><span class="comment">-- 创建tb_brand表</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb_brand (</span><br><span class="line">    <span class="comment">-- id 主键</span></span><br><span class="line">    id           <span class="type">int</span> <span class="keyword">primary</span> key auto_increment,</span><br><span class="line">    <span class="comment">-- 品牌名称</span></span><br><span class="line">    brand_name   <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">    <span class="comment">-- 企业名称</span></span><br><span class="line">    company_name <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">    <span class="comment">-- 排序字段</span></span><br><span class="line">    ordered      <span class="type">int</span>,</span><br><span class="line">    <span class="comment">-- 描述信息</span></span><br><span class="line">    description  <span class="type">varchar</span>(<span class="number">100</span>),</span><br><span class="line">    <span class="comment">-- 状态：0：禁用  1：启用</span></span><br><span class="line">    status       <span class="type">int</span></span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 添加数据</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_brand (brand_name, company_name, ordered, description, status)</span><br><span class="line"><span class="keyword">values</span> </span><br><span class="line">       (<span class="string">&#x27;华为&#x27;</span>, <span class="string">&#x27;华为技术有限公司&#x27;</span>, <span class="number">100</span>, <span class="string">&#x27;万物互联&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">       (<span class="string">&#x27;小米&#x27;</span>, <span class="string">&#x27;小米科技有限公司&#x27;</span>, <span class="number">50</span>, <span class="string">&#x27;are you ok&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">       (<span class="string">&#x27;格力&#x27;</span>, <span class="string">&#x27;格力电器股份有限公司&#x27;</span>, <span class="number">30</span>, <span class="string">&#x27;让世界爱上中国造&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">       (<span class="string">&#x27;阿里巴巴&#x27;</span>, <span class="string">&#x27;阿里巴巴集团控股有限公司&#x27;</span>, <span class="number">10</span>, <span class="string">&#x27;买买买&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">       (<span class="string">&#x27;腾讯&#x27;</span>, <span class="string">&#x27;腾讯计算机系统有限公司&#x27;</span>, <span class="number">50</span>, <span class="string">&#x27;玩玩玩&#x27;</span>, <span class="number">0</span>),</span><br><span class="line">       (<span class="string">&#x27;百度&#x27;</span>, <span class="string">&#x27;百度在线网络技术公司&#x27;</span>, <span class="number">5</span>, <span class="string">&#x27;搜搜搜&#x27;</span>, <span class="number">0</span>),</span><br><span class="line">       (<span class="string">&#x27;京东&#x27;</span>, <span class="string">&#x27;北京京东世纪贸易有限公司&#x27;</span>, <span class="number">40</span>, <span class="string">&#x27;就是快&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">       (<span class="string">&#x27;小米&#x27;</span>, <span class="string">&#x27;小米科技有限公司&#x27;</span>, <span class="number">50</span>, <span class="string">&#x27;are you ok&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">       (<span class="string">&#x27;三只松鼠&#x27;</span>, <span class="string">&#x27;三只松鼠股份有限公司&#x27;</span>, <span class="number">5</span>, <span class="string">&#x27;好吃不上火&#x27;</span>, <span class="number">0</span>),</span><br><span class="line">       (<span class="string">&#x27;华为&#x27;</span>, <span class="string">&#x27;华为技术有限公司&#x27;</span>, <span class="number">100</span>, <span class="string">&#x27;万物互联&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">       (<span class="string">&#x27;小米&#x27;</span>, <span class="string">&#x27;小米科技有限公司&#x27;</span>, <span class="number">50</span>, <span class="string">&#x27;are you ok&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">       (<span class="string">&#x27;格力&#x27;</span>, <span class="string">&#x27;格力电器股份有限公司&#x27;</span>, <span class="number">30</span>, <span class="string">&#x27;让世界爱上中国造&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">       (<span class="string">&#x27;阿里巴巴&#x27;</span>, <span class="string">&#x27;阿里巴巴集团控股有限公司&#x27;</span>, <span class="number">10</span>, <span class="string">&#x27;买买买&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">       (<span class="string">&#x27;腾讯&#x27;</span>, <span class="string">&#x27;腾讯计算机系统有限公司&#x27;</span>, <span class="number">50</span>, <span class="string">&#x27;玩玩玩&#x27;</span>, <span class="number">0</span>),</span><br><span class="line">       (<span class="string">&#x27;百度&#x27;</span>, <span class="string">&#x27;百度在线网络技术公司&#x27;</span>, <span class="number">5</span>, <span class="string">&#x27;搜搜搜&#x27;</span>, <span class="number">0</span>),</span><br><span class="line">       (<span class="string">&#x27;京东&#x27;</span>, <span class="string">&#x27;北京京东世纪贸易有限公司&#x27;</span>, <span class="number">40</span>, <span class="string">&#x27;就是快&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">       (<span class="string">&#x27;华为&#x27;</span>, <span class="string">&#x27;华为技术有限公司&#x27;</span>, <span class="number">100</span>, <span class="string">&#x27;万物互联&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">       (<span class="string">&#x27;小米&#x27;</span>, <span class="string">&#x27;小米科技有限公司&#x27;</span>, <span class="number">50</span>, <span class="string">&#x27;are you ok&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">       (<span class="string">&#x27;格力&#x27;</span>, <span class="string">&#x27;格力电器股份有限公司&#x27;</span>, <span class="number">30</span>, <span class="string">&#x27;让世界爱上中国造&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">       (<span class="string">&#x27;阿里巴巴&#x27;</span>, <span class="string">&#x27;阿里巴巴集团控股有限公司&#x27;</span>, <span class="number">10</span>, <span class="string">&#x27;买买买&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">       (<span class="string">&#x27;腾讯&#x27;</span>, <span class="string">&#x27;腾讯计算机系统有限公司&#x27;</span>, <span class="number">50</span>, <span class="string">&#x27;玩玩玩&#x27;</span>, <span class="number">0</span>),</span><br><span class="line">       (<span class="string">&#x27;百度&#x27;</span>, <span class="string">&#x27;百度在线网络技术公司&#x27;</span>, <span class="number">5</span>, <span class="string">&#x27;搜搜搜&#x27;</span>, <span class="number">0</span>),</span><br><span class="line">       (<span class="string">&#x27;京东&#x27;</span>, <span class="string">&#x27;北京京东世纪贸易有限公司&#x27;</span>, <span class="number">40</span>, <span class="string">&#x27;就是快&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">       (<span class="string">&#x27;小米&#x27;</span>, <span class="string">&#x27;小米科技有限公司&#x27;</span>, <span class="number">50</span>, <span class="string">&#x27;are you ok&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">       (<span class="string">&#x27;三只松鼠&#x27;</span>, <span class="string">&#x27;三只松鼠股份有限公司&#x27;</span>, <span class="number">5</span>, <span class="string">&#x27;好吃不上火&#x27;</span>, <span class="number">0</span>),</span><br><span class="line">       (<span class="string">&#x27;华为&#x27;</span>, <span class="string">&#x27;华为技术有限公司&#x27;</span>, <span class="number">100</span>, <span class="string">&#x27;万物互联&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">       (<span class="string">&#x27;小米&#x27;</span>, <span class="string">&#x27;小米科技有限公司&#x27;</span>, <span class="number">50</span>, <span class="string">&#x27;are you ok&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">       (<span class="string">&#x27;格力&#x27;</span>, <span class="string">&#x27;格力电器股份有限公司&#x27;</span>, <span class="number">30</span>, <span class="string">&#x27;让世界爱上中国造&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">       (<span class="string">&#x27;阿里巴巴&#x27;</span>, <span class="string">&#x27;阿里巴巴集团控股有限公司&#x27;</span>, <span class="number">10</span>, <span class="string">&#x27;买买买&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">       (<span class="string">&#x27;腾讯&#x27;</span>, <span class="string">&#x27;腾讯计算机系统有限公司&#x27;</span>, <span class="number">50</span>, <span class="string">&#x27;玩玩玩&#x27;</span>, <span class="number">0</span>),</span><br><span class="line">       (<span class="string">&#x27;百度&#x27;</span>, <span class="string">&#x27;百度在线网络技术公司&#x27;</span>, <span class="number">5</span>, <span class="string">&#x27;搜搜搜&#x27;</span>, <span class="number">0</span>),</span><br><span class="line">       (<span class="string">&#x27;京东&#x27;</span>, <span class="string">&#x27;北京京东世纪贸易有限公司&#x27;</span>, <span class="number">40</span>, <span class="string">&#x27;就是快&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">       (<span class="string">&#x27;华为&#x27;</span>, <span class="string">&#x27;华为技术有限公司&#x27;</span>, <span class="number">100</span>, <span class="string">&#x27;万物互联&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">       (<span class="string">&#x27;小米&#x27;</span>, <span class="string">&#x27;小米科技有限公司&#x27;</span>, <span class="number">50</span>, <span class="string">&#x27;are you ok&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">       (<span class="string">&#x27;格力&#x27;</span>, <span class="string">&#x27;格力电器股份有限公司&#x27;</span>, <span class="number">30</span>, <span class="string">&#x27;让世界爱上中国造&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">       (<span class="string">&#x27;阿里巴巴&#x27;</span>, <span class="string">&#x27;阿里巴巴集团控股有限公司&#x27;</span>, <span class="number">10</span>, <span class="string">&#x27;买买买&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">       (<span class="string">&#x27;腾讯&#x27;</span>, <span class="string">&#x27;腾讯计算机系统有限公司&#x27;</span>, <span class="number">50</span>, <span class="string">&#x27;玩玩玩&#x27;</span>, <span class="number">0</span>),</span><br><span class="line">       (<span class="string">&#x27;百度&#x27;</span>, <span class="string">&#x27;百度在线网络技术公司&#x27;</span>, <span class="number">5</span>, <span class="string">&#x27;搜搜搜&#x27;</span>, <span class="number">0</span>),</span><br><span class="line">       (<span class="string">&#x27;京东&#x27;</span>, <span class="string">&#x27;北京京东世纪贸易有限公司&#x27;</span>, <span class="number">40</span>, <span class="string">&#x27;就是快&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">       (<span class="string">&#x27;小米&#x27;</span>, <span class="string">&#x27;小米科技有限公司&#x27;</span>, <span class="number">50</span>, <span class="string">&#x27;are you ok&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">       (<span class="string">&#x27;三只松鼠&#x27;</span>, <span class="string">&#x27;三只松鼠股份有限公司&#x27;</span>, <span class="number">5</span>, <span class="string">&#x27;好吃不上火&#x27;</span>, <span class="number">0</span>),</span><br><span class="line">       (<span class="string">&#x27;华为&#x27;</span>, <span class="string">&#x27;华为技术有限公司&#x27;</span>, <span class="number">100</span>, <span class="string">&#x27;万物互联&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">       (<span class="string">&#x27;小米&#x27;</span>, <span class="string">&#x27;小米科技有限公司&#x27;</span>, <span class="number">50</span>, <span class="string">&#x27;are you ok&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">       (<span class="string">&#x27;格力&#x27;</span>, <span class="string">&#x27;格力电器股份有限公司&#x27;</span>, <span class="number">30</span>, <span class="string">&#x27;让世界爱上中国造&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">       (<span class="string">&#x27;阿里巴巴&#x27;</span>, <span class="string">&#x27;阿里巴巴集团控股有限公司&#x27;</span>, <span class="number">10</span>, <span class="string">&#x27;买买买&#x27;</span>, <span class="number">1</span>),</span><br><span class="line">       (<span class="string">&#x27;腾讯&#x27;</span>, <span class="string">&#x27;腾讯计算机系统有限公司&#x27;</span>, <span class="number">50</span>, <span class="string">&#x27;玩玩玩&#x27;</span>, <span class="number">0</span>),</span><br><span class="line">       (<span class="string">&#x27;百度&#x27;</span>, <span class="string">&#x27;百度在线网络技术公司&#x27;</span>, <span class="number">5</span>, <span class="string">&#x27;搜搜搜&#x27;</span>, <span class="number">0</span>),</span><br><span class="line">       (<span class="string">&#x27;京东&#x27;</span>, <span class="string">&#x27;北京京东世纪贸易有限公司&#x27;</span>, <span class="number">40</span>, <span class="string">&#x27;就是快&#x27;</span>, <span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<h2 id="3查询所有功能"><a class="markdownIt-Anchor" href="#3查询所有功能"></a> 3，查询所有功能</h2>
<p><img src="assets/image-20210825200138600.png" alt="image-20210825200138600" /></p>
<p>如上图所示是查询所有品牌数据在页面展示的效果。要实现这个功能，要先搞明白如下问题：</p>
<ul>
<li>
<p>什么时候发送异步请求？</p>
<p>页面加载完毕后就需要在页面上看到所有的品牌数据。所以在 <code>mounted()</code> 这个构造函数中写发送异步请求的代码。</p>
</li>
<li>
<p>请求需要携带参数吗？</p>
<p>查询所有功能不需要携带什么参数。</p>
</li>
<li>
<p>响应的数据格式是什么样？</p>
<p>后端是需要将 <code>List&lt;Brand&gt;</code> 对象转换为 JSON 格式的数据并响应回给浏览器。响应数据格式如下：</p>
<p><img src="assets/image-20210825201634849.png" alt="image-20210825201634849" /></p>
</li>
</ul>
<p>整体流程如下</p>
<p><img src="./image-20210825200332542.png" alt="image-20210825200332542" /></p>
<p>我们先实现后端程序，然后再实现前端程序。</p>
<h3 id="31-后端实现"><a class="markdownIt-Anchor" href="#31-后端实现"></a> 3.1 后端实现</h3>
<h4 id="311-dao方法实现"><a class="markdownIt-Anchor" href="#311-dao方法实现"></a> 3.1.1  dao方法实现</h4>
<p>在 <code>com.itheima.mapper.BrandMapper</code> 接口中定义抽象方法，并使用 <code>@Select</code> 注解编写 sql 语句</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Select(&quot;select * from tb_brand&quot;)</span></span><br><span class="line"><span class="function">List&lt;Brand&gt; <span class="title">selectAll</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>
<p>由于表中有些字段名和实体类中的属性名没有对应，所以需要在 <code>com/itheima/mapper/BrandMapper.xml</code> 映射配置文件中定义结果映射 ，使用<code>resultMap</code> 标签。映射配置文件内容如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.itheima.mapper.BrandMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;brandResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;brand&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;brandName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;brand_name&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;companyName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;company_name&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>定义完结果映射关系后，在接口 <code>selectAll()</code> 方法上引用该结构映射。使用 <code>@ResultMap(&quot;brandResultMap&quot;)</code> 注解</p>
<p>完整接口的 <code>selectAll()</code> 方法如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Select(&quot;select * from tb_brand&quot;)</span></span><br><span class="line"><span class="meta">@ResultMap(&quot;brandResultMap&quot;)</span></span><br><span class="line"><span class="function">List&lt;Brand&gt; <span class="title">selectAll</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>
<h4 id="312-service方法实现"><a class="markdownIt-Anchor" href="#312-service方法实现"></a> 3.1.2  service方法实现</h4>
<p>在 <code>com.itheima.service</code> 包下创建 <code>BrandService</code> 接口，在该接口中定义查询所有的抽象方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BrandService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询所有</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">List&lt;Brand&gt; <span class="title">selectAll</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>并在 <code>com.itheima.service</code> 下再创建 <code>impl</code> 包；<code>impl</code> 表示是放 service 层接口的实现类的包。 在该包下创建名为 <code>BrandServiceImpl</code> 类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BrandServiceImpl</span> <span class="keyword">implements</span> <span class="title">BrandService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Brand&gt; <span class="title">selectAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此处为什么要给 service 定义接口呢？因为service定义了接口后，在 servlet 中就可以使用多态的形式创建Service实现类的对象，如下：</p>
<img src="assets/image-20210825203843142.png" alt="image-20210825203843142" style="zoom:80%;" />
<p>这里使用多态是因为方便我们后期解除 <code>Servlet</code> 和 <code>service</code> 的耦合。从上面的代码我们可以看到 <code>SelectAllServlet</code> 类和 <code>BrandServiceImpl</code> 类之间是耦合在一起的，如果后期 <code>BrandService</code> 有其它更好的实现类（例如叫 <code>BrandServiceImpl</code>），那就需要修改 <code>SelectAllServlet</code> 类中的代码。后面我们学习了 <code>Spring</code> 框架后就可以解除 <code>SelectAllServlet</code> 类和红色框括起来的代码耦合。而现在咱们还做不到解除耦合，在这里只需要理解为什么定义接口即可。</p>
<p><code>BrandServiceImpl</code> 类代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BrandServiceImpl</span> <span class="keyword">implements</span> <span class="title">BrandService</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1. 创建SqlSessionFactory 工厂对象</span></span><br><span class="line">    SqlSessionFactory factory = SqlSessionFactoryUtils.getSqlSessionFactory();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Brand&gt; <span class="title">selectAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//2. 获取SqlSession对象</span></span><br><span class="line">        SqlSession sqlSession = factory.openSession();</span><br><span class="line">        <span class="comment">//3. 获取BrandMapper</span></span><br><span class="line">        BrandMapper mapper = sqlSession.getMapper(BrandMapper.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4. 调用方法</span></span><br><span class="line">        List&lt;Brand&gt; brands = mapper.selectAll();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5. 释放资源</span></span><br><span class="line">        sqlSession.close();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> brands;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="313-servlet实现"><a class="markdownIt-Anchor" href="#313-servlet实现"></a> 3.1.3  servlet实现</h4>
<p>在 <code>com.itheima.web.servlet</code> 包下定义名为 <code>SelectAllServlet</code> 的查询所有的 <code>servlet</code>。该 <code>servlet</code> 逻辑如下：</p>
<ul>
<li>调用service的 <code>selectAll()</code> 方法查询所有的品牌数据，并接口返回结果</li>
<li>将返回的结果转换为 json 数据</li>
<li>响应 json 数据</li>
</ul>
<p>代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/selectAllServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SelectAllServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> BrandService brandService = <span class="keyword">new</span> BrandServiceImpl();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//1. 调用service查询</span></span><br><span class="line">        List&lt;Brand&gt; brands = brandService.selectAll();</span><br><span class="line">        <span class="comment">//2. 转为JSON</span></span><br><span class="line">        String jsonString = JSON.toJSONString(brands);</span><br><span class="line">        <span class="comment">//3. 写数据</span></span><br><span class="line">        response.setContentType(<span class="string">&quot;text/json;charset=utf-8&quot;</span>); <span class="comment">//告知浏览器响应的数据是什么， 告知浏览器使用什么字符集进行解码</span></span><br><span class="line">        response.getWriter().write(jsonString);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="314-测试后端程序"><a class="markdownIt-Anchor" href="#314-测试后端程序"></a> 3.1.4  测试后端程序</h4>
<p>在浏览器输入访问 servlet 的资源路径 <code>http://localhost:8080/brand-case/selectAllServlet</code> ，如果没有报错，并能看到如下信息表明后端程序没有问题</p>
<p><img src="assets/image-20210825205133752.png" alt="image-20210825205133752" /></p>
<h3 id="32-前端实现"><a class="markdownIt-Anchor" href="#32-前端实现"></a> 3.2  前端实现</h3>
<p>前端需要在页面加载完毕后发送 ajax 请求，所以发送请求的逻辑应该放在 <code>mounted()</code> 钩子函数中。而响应回来的数据需要赋值给表格绑定的数据模型，从下图可以看出表格绑定的数据模型是 <code>tableData</code></p>
<img src="assets/image-20210825220436889.png" alt="image-20210825220436889" style="zoom:70%;" />
<p>前端代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">mounted</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//当页面加载完成后，发送异步请求，获取数据</span></span><br><span class="line">    <span class="keyword">var</span> _this = <span class="built_in">this</span>;</span><br><span class="line"></span><br><span class="line">    axios(&#123;</span><br><span class="line">        <span class="attr">method</span>:<span class="string">&quot;get&quot;</span>,</span><br><span class="line">        <span class="attr">url</span>:<span class="string">&quot;http://localhost:8080/brand-case/selectAllServlet&quot;</span></span><br><span class="line">    &#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">resp</span>) </span>&#123;</span><br><span class="line">        _this.tableData = resp.data;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4添加功能"><a class="markdownIt-Anchor" href="#4添加功能"></a> 4，添加功能</h2>
<img src="assets/image-20210825221138245.png" alt="image-20210825221138245" style="zoom:70%;" />
<p>上图是添加数据的对话框，当点击 <code>提交</code> 按钮后就需要将数据提交到后端，并将数据保存到数据库中。下图是整体的流程：</p>
<p><img src="assets/image-20210825221329231.png" alt="image-20210825221329231" /></p>
<p>页面发送请求时，需要将输入框输入的内容提交给后端程序，而这里是以 json 格式进行传递的。而具体的数据格式如下：</p>
<p><img src="assets/image-20210826185917510.png" alt="image-20210826185917510" /></p>
<blockquote>
<p><mark>注意：由于是添加数据，所以上述json数据中id是没有值的。</mark></p>
</blockquote>
<h3 id="41-后端实现"><a class="markdownIt-Anchor" href="#41-后端实现"></a> 4.1  后端实现</h3>
<h4 id="411-dao方法实现"><a class="markdownIt-Anchor" href="#411-dao方法实现"></a> 4.1.1  dao方法实现</h4>
<p>在 <code>BrandMapper</code> 接口中定义 <code>add()</code> 添加方法，并使用 <code>@Insert</code> 注解编写sql语句</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> brand</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Insert(&quot;insert into tb_brand values(null,#&#123;brandName&#125;,#&#123;companyName&#125;,#&#123;ordered&#125;,#&#123;description&#125;,#&#123;status&#125;)&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(Brand brand)</span></span>;</span><br></pre></td></tr></table></figure>
<h4 id="412-service方法实现"><a class="markdownIt-Anchor" href="#412-service方法实现"></a> 4.1.2  service方法实现</h4>
<p>在 <code>BrandService</code> 接口中定义 <code>add()</code> 添加数据的业务逻辑方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> brand</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(Brand brand)</span></span>;</span><br></pre></td></tr></table></figure>
<p>在 <code>BrandServiceImpl</code> 类中重写 <code>add()</code> 方法，并进行业务逻辑实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Brand brand)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//2. 获取SqlSession对象</span></span><br><span class="line">    SqlSession sqlSession = factory.openSession();</span><br><span class="line">    <span class="comment">//3. 获取BrandMapper</span></span><br><span class="line">    BrandMapper mapper = sqlSession.getMapper(BrandMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4. 调用方法</span></span><br><span class="line">    mapper.add(brand);</span><br><span class="line">    sqlSession.commit();<span class="comment">//提交事务</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//5. 释放资源</span></span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><mark>注意：增删改操作一定要提交事务。</mark></p>
</blockquote>
<h4 id="413-servlet实现"><a class="markdownIt-Anchor" href="#413-servlet实现"></a> 4.1.3  servlet实现</h4>
<p>在 <code>com.itheima.web.servlet</code> 包写定义名为 <code>AddServlet</code> 的 Servlet。该 Servlet 的逻辑如下：</p>
<ul>
<li>接收页面提交的数据。页面到时候提交的数据是 json 格式的数据，所以此处需要使用输入流读取数据</li>
<li>将接收到的数据转换为 <code>Brand</code> 对象</li>
<li>调用 service 的 <code>add()</code> 方法进行添加的业务逻辑处理</li>
<li>给浏览器响应添加成功的标识，这里直接给浏览器响应 <code>success</code> 字符串表示成功</li>
</ul>
<p>servlet 代码实现如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/addServlet&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AddServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> BrandService brandService = <span class="keyword">new</span> BrandServiceImpl();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1. 接收品牌数据</span></span><br><span class="line">        BufferedReader br = request.getReader();</span><br><span class="line">        String params = br.readLine();<span class="comment">//json字符串</span></span><br><span class="line">        <span class="comment">//转为Brand对象</span></span><br><span class="line">        Brand brand = JSON.parseObject(params, Brand.class);</span><br><span class="line">        <span class="comment">//2. 调用service添加</span></span><br><span class="line">        brandService.add(brand);</span><br><span class="line">        <span class="comment">//3. 响应成功的标识</span></span><br><span class="line">        response.getWriter().write(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.doGet(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="42-前端实现"><a class="markdownIt-Anchor" href="#42-前端实现"></a> 4.2  前端实现</h3>
<img src="assets/image-20210825223121993.png" alt="image-20210825223121993" style="zoom:60%;" />
<p>上图左边是页面效果，里面的 <code>提交</code> 按钮可以通过上图右边看出绑定了一个 单击事件，而该事件绑定的是 <code>addBrand</code> 函数，所以添加数据功能的逻辑代码应该写在 <code>addBrand()</code>  函数中。在此方法中需要发送异步请求并将表单中输入的数据作为参数进行传递。如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加数据</span></span><br><span class="line"><span class="function"><span class="title">addBrand</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> _this = <span class="built_in">this</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 发送ajax请求，添加数据</span></span><br><span class="line">    axios(&#123;</span><br><span class="line">        <span class="attr">method</span>:<span class="string">&quot;post&quot;</span>,</span><br><span class="line">        <span class="attr">url</span>:<span class="string">&quot;http://localhost:8080/brand-case/addServlet&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>:_this.brand</span><br><span class="line">    &#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">resp</span>) </span>&#123;</span><br><span class="line">       	<span class="comment">//响应数据的处理逻辑</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 <code>then</code> 函数中的匿名函数是成功后的回调函数，而 <code>resp.data</code> 就可以获取到响应回来的数据，如果值是 <code>success</code> 表示数据添加成功。成功后我们需要做一下逻辑处理：</p>
<ol>
<li>
<p><strong>关闭新增对话框窗口</strong></p>
<p>如下图所示是添加数据的对话框代码，从代码中可以看到此对话框绑定了 <code>dialogVisible</code> 数据模型，只需要将该数据模型的值设置为 false，就可以关闭新增对话框窗口了。</p>
<img src="assets/image-20210825223933953.png" alt="image-20210825223933953" style="zoom:70%;" />
</li>
<li>
<p><strong>重新查询数据</strong></p>
<p>数据添加成功与否，用户只要能在页面上查看到数据说明添加成功。而此处需要重新发送异步请求获取所有的品牌数据，而这段代码在 <code>查询所有</code> 功能中已经实现，所以我们可以将此功能代码进行抽取，抽取到一个 <code>selectAll()</code> 函数中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询所有数据</span></span><br><span class="line"><span class="function"><span class="title">selectAll</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _this = <span class="built_in">this</span>;</span><br><span class="line"></span><br><span class="line">    axios(&#123;</span><br><span class="line">        <span class="attr">method</span>:<span class="string">&quot;get&quot;</span>,</span><br><span class="line">        <span class="attr">url</span>:<span class="string">&quot;http://localhost:8080/brand-case/selectAllServlet&quot;</span></span><br><span class="line">    &#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">resp</span>) </span>&#123;</span><br><span class="line">        _this.tableData = resp.data;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那么就需要将 <code>mounted()</code> 钩子函数中代码改进为</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">mounted</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//当页面加载完成后，发送异步请求，获取数据</span></span><br><span class="line">    <span class="built_in">this</span>.selectAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同时在新增响应的回调中调用 <code>selectAll()</code> 进行数据的重新查询。</p>
</li>
<li>
<p><strong>弹出消息给用户提示添加成功</strong></p>
<p><img src="assets/image-20210825224958220.png" alt="image-20210825224958220" /></p>
<p>上图左边就是 elementUI 官网提供的成功提示代码，而上图右边是具体的效果。</p>
<blockquote>
<p><mark>注意：上面的this需要的是表示 VUE 对象的this。</mark></p>
</blockquote>
</li>
</ol>
<p>综上所述，前端代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加数据</span></span><br><span class="line"><span class="function"><span class="title">addBrand</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> _this = <span class="built_in">this</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 发送ajax请求，添加数据</span></span><br><span class="line">    axios(&#123;</span><br><span class="line">        <span class="attr">method</span>:<span class="string">&quot;post&quot;</span>,</span><br><span class="line">        <span class="attr">url</span>:<span class="string">&quot;http://localhost:8080/brand-case/addServlet&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>:_this.brand</span><br><span class="line">    &#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">resp</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(resp.data == <span class="string">&quot;success&quot;</span>)&#123;</span><br><span class="line">            <span class="comment">//添加成功</span></span><br><span class="line">            <span class="comment">//关闭窗口</span></span><br><span class="line">            _this.dialogVisible = <span class="literal">false</span>;</span><br><span class="line">            <span class="comment">// 重新查询数据</span></span><br><span class="line">            _this.selectAll();</span><br><span class="line">            <span class="comment">// 弹出消息提示</span></span><br><span class="line">            _this.$message(&#123;</span><br><span class="line">                <span class="attr">message</span>: <span class="string">&#x27;恭喜你，添加成功&#x27;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="5servlet优化"><a class="markdownIt-Anchor" href="#5servlet优化"></a> 5，servlet优化</h2>
<h3 id="51-问题导入"><a class="markdownIt-Anchor" href="#51-问题导入"></a> 5.1  问题导入</h3>
<p><mark>Web 层的 Servlet 个数太多了，不利于管理和编写</mark></p>
<p>通过之前的两个功能，我们发现每一个功能都需要定义一个 <code>servlet</code>，一个模块需要实现增删改查功能，就需要4个 <code>servlet</code>，模块一多就会造成<code>servlet</code> 泛滥。此时我们就想 <code>servlet</code> 能不能像 <code>service</code> 一样，一个模块只定义一个 <code>servlet</code>，而每一个功能只需要在该 <code>servlet</code> 中定义对应的方法。例如下面代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/brand/*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BrandServlet</span> </span>&#123;</span><br><span class="line">    <span class="comment">//查询所有</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">selectAll</span><span class="params">(...)</span> </span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//添加数据</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(...)</span> </span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">     <span class="comment">//修改数据</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(...)</span> </span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//删除删除</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(...)</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>而我们知道发送请求 <code>servlet</code>，<code>tomcat</code> 会自动的调用 <code>service()</code> 方法，之前我们在自定义的 <code>servlet</code> 中重写 <code>doGet()</code> 方法和 <code>doPost()</code> 方法，当我们访问该 <code>servlet</code> 时会根据请求方式将请求分发给 <code>doGet()</code> 或者 <code>doPost()</code>  方法，如下图</p>
<img src="assets/image-20210826184103210.png" alt="image-20210826184103210" style="zoom:80%;" />
<p>那么我们也可以仿照这样请求分发的思想，在 <code>service()</code> 方法中根据具体的操作调用对应的方法，如：查询所有就调用 <code>selectAll()</code> 方法，添加企业信息就调用 <code>add()</code> 方法。</p>
<p>为了做到通用，我们定义一个通用的 <code>servlet</code> 类，在定义其他的 <code>servlet</code> 是不需要继承 <code>HttpServlet</code>，而继承我们定义的 <code>BaseServlet</code>，在<code> BaseServlet</code> 中调用具体 <code>servlet</code>（如<code>BrandServlet</code>）中的对应方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//进行请求的分发</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>BrandServlet</code> 定义就需要修改为如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/brand/*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BrandServlet</span> <span class="keyword">extends</span> <span class="title">BaseServlet</span> </span>&#123;</span><br><span class="line">    <span class="comment">//用户实现分页查询</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">selectAll</span><span class="params">(...)</span> </span>&#123;&#125; </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//添加企业信息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(...)</span> </span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//修改企业信息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(...)</span> </span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//删除企业信息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(...)</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那么如何在 <code>BaseServlet</code> 中调用对应的方法呢？比如查询所有就调用 <code>selectAll()</code> 方法。</p>
<p>可以<mark>规定在发送请求时，请求资源的二级路径（/brandServlet/selectAll）和需要调用的方法名相同</mark>，如：</p>
<p>查询所有数据的路径以后就需要写成： <code>http://localhost:8080/brand-case/brandServlet/selectAll</code></p>
<p>添加数据的路径以后就需要写成： <code>http://localhost:8080/brand-case/brandServlet/add</code></p>
<p>修改数据的路径以后就需要写成： <code>http://localhost:8080/brand-case/brandServlet/update</code></p>
<p>删除数据的路径以后就需要写成： <code>http://localhost:8080/brand-case/brandServlet/delete</code></p>
<p>这样的话，在 <code>BaseServlet</code> 中就需要获取到资源的二级路径作为方法名，然后调用该方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//1. 获取请求路径</span></span><br><span class="line">        String uri = req.getRequestURI(); <span class="comment">// 例如路径为：/brand-case/brand/selectAll</span></span><br><span class="line">        <span class="comment">//2. 获取最后一段路径，方法名</span></span><br><span class="line">        <span class="keyword">int</span> index = uri.lastIndexOf(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">        String methodName = uri.substring(index + <span class="number">1</span>); <span class="comment">//  获取到资源的二级路径  selectAll</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 执行方法</span></span><br><span class="line">        <span class="comment">//2.1 获取BrandServlet /UserServlet 字节码对象 Class</span></span><br><span class="line">        <span class="comment">//System.out.println(this);</span></span><br><span class="line"></span><br><span class="line">        Class&lt;? extends BaseServlet&gt; cls = <span class="keyword">this</span>.getClass();</span><br><span class="line">        <span class="comment">//2.2 获取方法 Method对象</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Method method = cls.getMethod(methodName,？？？);</span><br><span class="line">            <span class="comment">//4,调用该方法</span></span><br><span class="line">            method.invoke(<span class="keyword">this</span>,？？？);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过上面代码发现根据方法名获取对应方法的 <code>Method</code> 对象时需要指定方法参数的字节码对象。解决这个问题，可以将方法的参数类型规定死，而方法中可能需要用到 <code>request</code> 对象和 <code>response</code> 对象，所以指定方法的参数为 <code>HttpServletRequest</code> 和 <code>HttpServletResponse</code>，那么 <code>BrandServlet</code> 代码就可以改进为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/brand/*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BrandServlet</span> <span class="keyword">extends</span> <span class="title">BaseServlet</span> </span>&#123;</span><br><span class="line">    <span class="comment">//用户实现分页查询</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">selectAll</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> </span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//添加企业信息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> </span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//修改企业信息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> </span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//删除企业信息</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>BaseServlet代码可以改进为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//根据请求的最后一段路径来进行方法分发</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//1. 获取请求路径</span></span><br><span class="line">        String uri = req.getRequestURI(); <span class="comment">// 例如路径为：/brand-case/brand/selectAll</span></span><br><span class="line">        <span class="comment">//2. 获取最后一段路径，方法名</span></span><br><span class="line">        <span class="keyword">int</span> index = uri.lastIndexOf(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">        String methodName = uri.substring(index + <span class="number">1</span>); <span class="comment">//  获取到资源的二级路径  selectAll   </span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 执行方法</span></span><br><span class="line">        <span class="comment">//2.1 获取BrandServlet /UserServlet 字节码对象 Class</span></span><br><span class="line">        <span class="comment">//System.out.println(this);</span></span><br><span class="line"></span><br><span class="line">        Class&lt;? extends BaseServlet&gt; cls = <span class="keyword">this</span>.getClass();</span><br><span class="line">        <span class="comment">//2.2 获取方法 Method对象</span></span><br><span class="line">        <span class="keyword">try</span> &#123;   </span><br><span class="line">            Method method = cls.getMethod(methodName, HttpServletRequest.class, HttpServletResponse.class);</span><br><span class="line">            <span class="comment">//2.3 执行方法</span></span><br><span class="line">            method.invoke(<span class="keyword">this</span>,req,resp);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="52-代码优化"><a class="markdownIt-Anchor" href="#52-代码优化"></a> 5.2  代码优化</h3>
<h4 id="521-后端优化"><a class="markdownIt-Anchor" href="#521-后端优化"></a> 5.2.1  后端优化</h4>
<p>定义了 <code>BaseServlet</code> 后，针对品牌模块我们定义一个 <code>BrandServlet</code> 的 Servlet，并使其继承 <code>BaseServlet</code> 。在<code>BrandServlet</code>中定义 以下功能的方法：</p>
<ul>
<li><code>查询所有</code>  功能：方法名声明为 <code>selectAll</code> ，并将之前的 <code>SelectAllServlet</code> 中的逻辑代码拷贝到该方法中</li>
<li><code>添加数据</code> 功能：方法名声明为 <code>add</code> ，并将之前的 <code>AddServlet</code> 中的逻辑代码拷贝到该方法中</li>
</ul>
<p>具体代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet(&quot;/brand/*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BrandServlet</span> <span class="keyword">extends</span> <span class="title">BaseServlet</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> BrandService brandService = <span class="keyword">new</span> BrandServiceImpl();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">selectAll</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//1. 调用service查询</span></span><br><span class="line">        List&lt;Brand&gt; brands = brandService.selectAll();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 转为JSON</span></span><br><span class="line">        String jsonString = JSON.toJSONString(brands);</span><br><span class="line">        <span class="comment">//3. 写数据</span></span><br><span class="line">        response.setContentType(<span class="string">&quot;text/json;charset=utf-8&quot;</span>);</span><br><span class="line">        response.getWriter().write(jsonString);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1. 接收品牌数据</span></span><br><span class="line">        BufferedReader br = request.getReader();</span><br><span class="line">        String params = br.readLine();<span class="comment">//json字符串</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//转为Brand对象</span></span><br><span class="line">        Brand brand = JSON.parseObject(params, Brand.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 调用service添加</span></span><br><span class="line">        brandService.add(brand);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 响应成功的标识</span></span><br><span class="line">        response.getWriter().write(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="522-前端优化"><a class="markdownIt-Anchor" href="#522-前端优化"></a> 5.2.2  前端优化</h4>
<p>页面中之前发送的请求的路径都需要进行修改，<code>selectAll()</code> 函数中发送异步请求的 <code>url</code> 应该改为 <code>http://localhost:8080/brand-case/brand/selectAll</code> 。具体代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询分页数据</span></span><br><span class="line"><span class="function"><span class="title">selectAll</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _this = <span class="built_in">this</span>;</span><br><span class="line"></span><br><span class="line">    axios(&#123;</span><br><span class="line">        <span class="attr">method</span>:<span class="string">&quot;get&quot;</span>,</span><br><span class="line">        <span class="attr">url</span>:<span class="string">&quot;http://localhost:8080/brand-case/brand/selectAll&quot;</span></span><br><span class="line">    &#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">resp</span>) </span>&#123;</span><br><span class="line">        _this.tableData = resp.data;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>addBrand()</code> 函数中发送异步请求的 <code>url</code> 应该改为 <code>http://localhost:8080/brand-case/brand/add</code> 。具体代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加数据</span></span><br><span class="line"><span class="function"><span class="title">addBrand</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">//console.log(this.brand);</span></span><br><span class="line">    <span class="keyword">var</span> _this = <span class="built_in">this</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 发送ajax请求，添加数据</span></span><br><span class="line">    axios(&#123;</span><br><span class="line">        <span class="attr">method</span>:<span class="string">&quot;post&quot;</span>,</span><br><span class="line">        <span class="attr">url</span>:<span class="string">&quot;http://localhost:8080/brand-case/brand/add&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>:_this.brand</span><br><span class="line">    &#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">resp</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(resp.data == <span class="string">&quot;success&quot;</span>)&#123;</span><br><span class="line">            <span class="comment">//添加成功</span></span><br><span class="line">            <span class="comment">//关闭窗口</span></span><br><span class="line">            _this.dialogVisible = <span class="literal">false</span>;</span><br><span class="line">            <span class="comment">// 重新查询数据</span></span><br><span class="line">            _this.selectAll();</span><br><span class="line">            <span class="comment">// 弹出消息提示</span></span><br><span class="line">            _this.$message(&#123;</span><br><span class="line">                <span class="attr">message</span>: <span class="string">&#x27;恭喜你，添加成功&#x27;</span>,</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="6批量删除"><a class="markdownIt-Anchor" href="#6批量删除"></a> 6，批量删除</h2>
<img src="assets/image-20210826185420668.png" alt="image-20210826185420668" style="zoom:70%;" />
<p>如上图所示点击多条数据前的复选框就意味着要删除这些数据，而点击了 <code>批量删除</code> 按钮后，需要让用户确认一下，因为有可能是用户误操作的，当用户确定后需要给后端发送请求并携带者需要删除数据的多个id值，后端程序删除数据库中的数据。具体的流程如下：</p>
<p><img src="assets/image-20210826201651241.png" alt="image-20210826201651241" /></p>
<p><mark>注意：</mark></p>
<p>前端发送请求时需要将要删除的多个id值以json格式提交给后端，而该json格式数据如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br></pre></td></tr></table></figure>
<h3 id="61-后端实现"><a class="markdownIt-Anchor" href="#61-后端实现"></a> 6.1  后端实现</h3>
<h4 id="611-dao方法实现"><a class="markdownIt-Anchor" href="#611-dao方法实现"></a> 6.1.1  dao方法实现</h4>
<p>在 <code>BrandMapper</code> 接口中定义 <code>deleteByIds()</code> 添加方法，由于这里面要用到动态 sql ，属于复杂的sql操作，建议使用映射配置文件。</p>
<p>接口方法声明如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量删除</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">deleteByIds</span><span class="params">(<span class="meta">@Param(&quot;ids&quot;)</span> <span class="keyword">int</span>[] ids)</span></span>;</span><br></pre></td></tr></table></figure>
<p>在 <code>BrandMapper.xml</code> 映射配置文件中添加 statement</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteByIds&quot;</span>&gt;</span></span><br><span class="line">    delete from tb_brand where id in</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;ids&quot;</span> <span class="attr">item</span>=<span class="string">&quot;id&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span></span><br><span class="line">        #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="612-service方法实现"><a class="markdownIt-Anchor" href="#612-service方法实现"></a> 6.1.2  service方法实现</h4>
<p>在 <code>BrandService</code> 接口中定义 <code>deleteByIds()</code> 批量删除的业务逻辑方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量删除</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ids</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">deleteByIds</span><span class="params">( <span class="keyword">int</span>[] ids)</span></span>;</span><br></pre></td></tr></table></figure>
<p>在 <code>BrandServiceImpl</code> 类中重写 <code>deleteByIds()</code> 方法，并进行业务逻辑实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteByIds</span><span class="params">(<span class="keyword">int</span>[] ids)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//2. 获取SqlSession对象</span></span><br><span class="line">    SqlSession sqlSession = factory.openSession();</span><br><span class="line">    <span class="comment">//3. 获取BrandMapper</span></span><br><span class="line">    BrandMapper mapper = sqlSession.getMapper(BrandMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4. 调用方法</span></span><br><span class="line">    mapper.deleteByIds(ids);</span><br><span class="line"></span><br><span class="line">    sqlSession.commit();<span class="comment">//提交事务</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//5. 释放资源</span></span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="613-servlet实现"><a class="markdownIt-Anchor" href="#613-servlet实现"></a> 6.1.3  servlet实现</h4>
<p>在 <code>BrandServlet</code> 类中定义 <code>deleteByIds()</code>  方法。而该方法的逻辑如下：</p>
<ul>
<li>接收页面提交的数据。页面到时候提交的数据是 json 格式的数据，所以此处需要使用输入流读取数据</li>
<li>接收页面提交的数据。页面到时候提交的数据是 json 格式的数据，所以此处需要使用输入流读取数据</li>
<li>将接收到的数据转换为 <code>int[]</code> 数组</li>
<li>调用 service 的 <code>deleteByIds()</code> 方法进行批量删除的业务逻辑处理</li>
<li>给浏览器响应添加成功的标识，这里直接给浏览器响应 <code>success</code> 字符串表示成功</li>
</ul>
<p>servlet 中 <code>deleteByIds()</code> 方法代码实现如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteByIds</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    <span class="comment">//1. 接收数据 json  [1,2,3]</span></span><br><span class="line">    BufferedReader br = request.getReader();</span><br><span class="line">    String params = br.readLine();<span class="comment">//json字符串</span></span><br><span class="line">    <span class="comment">//转为 int[]</span></span><br><span class="line">    <span class="keyword">int</span>[] ids = JSON.parseObject(params, <span class="keyword">int</span>[].class);</span><br><span class="line">    <span class="comment">//2. 调用service添加</span></span><br><span class="line">    brandService.deleteByIds(ids);</span><br><span class="line">    <span class="comment">//3. 响应成功的标识</span></span><br><span class="line">    response.getWriter().write(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="62-前端实现"><a class="markdownIt-Anchor" href="#62-前端实现"></a> 6.2  前端实现</h3>
<p>此功能的前端代码实现稍微有点麻烦，分为以下几步实现</p>
<h4 id="621-获取选中的id值"><a class="markdownIt-Anchor" href="#621-获取选中的id值"></a> 6.2.1  获取选中的id值</h4>
<img src="assets/image-20210826223103884.png" alt="image-20210826223103884" style="zoom:70%;" />
<p>从上图可以看出表格复选框绑定了一个 <code>selection-change</code> 事件，该事件是当选择项发生变化时会触发。该事件绑定了 <code>handleSelectionChange</code> 函数，而该函数有一个参数 <code>val</code> ，该参数是获取选中行的数据，如下</p>
<img src="assets/image-20210826223750518.png" alt="image-20210826223750518" style="zoom:70%;" />
<p>而我们只需要将所有选中数据的id值提交给服务端即可，获取id的逻辑我们书写在 <code>批量删除</code> 按钮绑定的函数中。</p>
<p>在 <code>批量删除</code> 按钮绑定单击事件，并给绑定触发时调用的函数，如下</p>
<img src="assets/image-20210826224121445.png" alt="image-20210826224121445" style="zoom:70%;" />
<p>并在Vue对象中的 methods 中定义 <code>deleteByIds()</code> 函数，在该函数中从 <code>multipleSelection</code> 数据模型中获取所选数据的id值。要完成这个功能需要在 Vue 对象中定义一个数据模型 <code>selectedIds:[]</code>，在 <code>deleteByIds()</code> 函数中遍历 <code>multipleSelection</code> 数组，并获取到每一个所选数据的id值存储到 <code>selectedIds</code> 数组中，代码实现如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1. 创建id数组 [1,2,3], 从 this.multipleSelection 获取即可</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>.multipleSelection.length; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> selectionElement = <span class="built_in">this</span>.multipleSelection[i];</span><br><span class="line">    <span class="built_in">this</span>.selectedIds[i] = selectionElement.id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="622-发送异步请求"><a class="markdownIt-Anchor" href="#622-发送异步请求"></a> 6.2.2  发送异步请求</h4>
<p>使用 axios 发送异步请求并经上一步获取到的存储所有的 id 数组作为请求参数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2. 发送AJAX请求</span></span><br><span class="line"><span class="keyword">var</span> _this = <span class="built_in">this</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发送ajax请求，添加数据</span></span><br><span class="line">axios(&#123;</span><br><span class="line">    <span class="attr">method</span>:<span class="string">&quot;post&quot;</span>,</span><br><span class="line">    <span class="attr">url</span>:<span class="string">&quot;http://localhost:8080/brand-case/brand/deleteByIds&quot;</span>,</span><br><span class="line">    <span class="attr">data</span>:_this.selectedIds</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">resp</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(resp.data == <span class="string">&quot;success&quot;</span>)&#123;</span><br><span class="line">        <span class="comment">//删除成功</span></span><br><span class="line">        <span class="comment">// 重新查询数据</span></span><br><span class="line">        _this.selectAll();</span><br><span class="line">        <span class="comment">// 弹出消息提示</span></span><br><span class="line">        _this.$message(&#123;</span><br><span class="line">            <span class="attr">message</span>: <span class="string">&#x27;恭喜你，删除成功&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="623-确定框实现"><a class="markdownIt-Anchor" href="#623-确定框实现"></a> 6.2.3  确定框实现</h4>
<p>由于删除操作是比较危险的；有时候可能是由于用户的误操作点击了 <code>批量删除</code> 按钮，所以在点击了按钮后需要先给用户确认提示。而确认框在 <code>elementUI</code> 中也提供了，如下图</p>
<p><img src="assets/image-20210826225742852.png" alt="image-20210826225742852" /></p>
<p>而在点击 <code>确定</code> 按钮后需要执行之前删除的逻辑。因此前端代码实现如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 批量删除</span></span><br><span class="line"><span class="function"><span class="title">deleteByIds</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 弹出确认提示框</span></span><br><span class="line">    <span class="built_in">this</span>.$confirm(<span class="string">&#x27;此操作将删除该数据, 是否继续?&#x27;</span>, <span class="string">&#x27;提示&#x27;</span>, &#123;</span><br><span class="line">        <span class="attr">confirmButtonText</span>: <span class="string">&#x27;确定&#x27;</span>,</span><br><span class="line">        <span class="attr">cancelButtonText</span>: <span class="string">&#x27;取消&#x27;</span>,</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;warning&#x27;</span></span><br><span class="line">    &#125;).then(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//用户点击确认按钮</span></span><br><span class="line">        <span class="comment">//1. 创建id数组 [1,2,3], 从 this.multipleSelection 获取即可</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="built_in">this</span>.multipleSelection.length; i++) &#123;</span><br><span class="line">            <span class="keyword">let</span> selectionElement = <span class="built_in">this</span>.multipleSelection[i];</span><br><span class="line">            <span class="built_in">this</span>.selectedIds[i] = selectionElement.id;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//2. 发送AJAX请求</span></span><br><span class="line">        <span class="keyword">var</span> _this = <span class="built_in">this</span>;</span><br><span class="line">        <span class="comment">// 发送ajax请求，添加数据</span></span><br><span class="line">        axios(&#123;</span><br><span class="line">            <span class="attr">method</span>:<span class="string">&quot;post&quot;</span>,</span><br><span class="line">            <span class="attr">url</span>:<span class="string">&quot;http://localhost:8080/brand-case/brand/deleteByIds&quot;</span>,</span><br><span class="line">            <span class="attr">data</span>:_this.selectedIds</span><br><span class="line">        &#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">resp</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(resp.data == <span class="string">&quot;success&quot;</span>)&#123;</span><br><span class="line">                <span class="comment">//删除成功</span></span><br><span class="line">                <span class="comment">// 重新查询数据</span></span><br><span class="line">                _this.selectAll();</span><br><span class="line">                <span class="comment">// 弹出消息提示</span></span><br><span class="line">                _this.$message(&#123;</span><br><span class="line">                    <span class="attr">message</span>: <span class="string">&#x27;恭喜你，删除成功&#x27;</span>,</span><br><span class="line">                    <span class="attr">type</span>: <span class="string">&#x27;success&#x27;</span></span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;).catch(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//用户点击取消按钮</span></span><br><span class="line">        <span class="built_in">this</span>.$message(&#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;info&#x27;</span>,</span><br><span class="line">            <span class="attr">message</span>: <span class="string">&#x27;已取消删除&#x27;</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="7分页查询"><a class="markdownIt-Anchor" href="#7分页查询"></a> 7，分页查询</h2>
<p>我们之前做的 <code>查询所有</code> 功能中将数据库中所有的数据查询出来并展示到页面上，试想如果数据库中的数据有很多（假设有十几万条）的时候，将数据全部展示出来肯定不现实，那如何解决这个问题呢？几乎所有的网站都会使用分页解决这个问题。每次只展示一页的数据，比如一页展示10条数据，如果还想看其他的数据，可以通过点击页码进行查询</p>
<p><img src="assets/image-20210826230648031.png" alt="image-20210826230648031" /></p>
<h3 id="71-分析"><a class="markdownIt-Anchor" href="#71-分析"></a> 7.1  分析</h3>
<h4 id="711-分页查询sql"><a class="markdownIt-Anchor" href="#711-分页查询sql"></a> 7.1.1  分页查询sql</h4>
<p>分页查询也是从数据库进行查询的，所以我们要分页对应的SQL语句应该怎么写。分页查询使用 <code>LIMIT</code> 关键字，格式为：<mark><code>LIMIT 开始索引 每页显示的条数</code></mark>。以后前端页面在发送请求携带参数时，它并不明确开始索引是什么，但是它知道查询第几页。所以 <code>开始索引</code> 需要在后端进行计算，计算的公式是 ：<mark>开始索引 = （当前页码 -  1）*  每页显示条数</mark></p>
<p>比如查询第一页的数据的 SQL 语句是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from tb_brand  limit 0,5;</span><br></pre></td></tr></table></figure>
<p>查询第二页的数据的 SQL 语句是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from tb_brand  limit 5,5;</span><br></pre></td></tr></table></figure>
<p>查询第三页的数据的 SQL 语句是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from tb_brand  limit 10,5;</span><br></pre></td></tr></table></figure>
<h4 id="712-前后端数据分析"><a class="markdownIt-Anchor" href="#712-前后端数据分析"></a> 7.1.2  前后端数据分析</h4>
<p>分页查询功能时候比较复杂的，所以我们要先分析清楚以下两个问题：</p>
<ul>
<li>
<p><strong>前端需要传递什么参数给后端</strong></p>
<p>根据上一步对分页查询 SQL 语句分析得出，前端需要给后端两个参数</p>
<ul>
<li>当前页码 ： currentPage</li>
<li>每页显示条数：pageSize</li>
</ul>
</li>
<li>
<p><strong>后端需要响应什么数据给前端</strong></p>
<img src="assets/image-20210826231842293.png" alt="image-20210826231842293" style="zoom:80%;" />
<p>上图是分页查询页面展示的效果，从上面我们可以看出需要响应以下联股份数据</p>
<ul>
<li>当前页需要展示的数据。我们在后端一般会存储到 List 集合中</li>
<li>总共记录数。在上图页面中需要展示总的记录数，所以这部分数据也需要。总的页面 elementUI 的分页组件会自动计算，我们不需要关心</li>
</ul>
<p>而这两部分需要封装到 PageBean 对象中，并将该对象转换为 json 格式的数据响应回给浏览器</p>
<img src="assets/image-20210826232158234.png" alt="image-20210826232158234" style="zoom:65%;" />
</li>
</ul>
<p>通过上面的分析我们需要先在 <code>pojo</code> 包下创建 <code>PageBean</code> 类，为了做到通过会将其定义成泛型类，代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//分页查询的JavaBean</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PageBean</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// 总记录数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> totalCount;</span><br><span class="line">    <span class="comment">// 当前页数据</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;T&gt; rows;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTotalCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> totalCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTotalCount</span><span class="params">(<span class="keyword">int</span> totalCount)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.totalCount = totalCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;T&gt; <span class="title">getRows</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> rows;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRows</span><span class="params">(List&lt;T&gt; rows)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.rows = rows;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="713-流程分析"><a class="markdownIt-Anchor" href="#713-流程分析"></a> 7.1.3  流程分析</h4>
<p>后端需要响应<code>总记录数</code> 和 <code>当前页的数据</code> 两部分数据给前端，所以在 <code>BrandMapper</code>  接口中需要定义两个方法：</p>
<ul>
<li>selectByPage() ：查询当前页的数据的方法</li>
<li>selectTotalCount() ：查询总记录的方法</li>
</ul>
<p>整体流程如下：</p>
<p><img src="assets/image-20210826232620404.png" alt="image-20210826232620404" /></p>
<h3 id="72-后端实现"><a class="markdownIt-Anchor" href="#72-后端实现"></a> 7.2  后端实现</h3>
<h4 id="721-dao方法实现"><a class="markdownIt-Anchor" href="#721-dao方法实现"></a> 7.2.1  dao方法实现</h4>
<p>在 <code>BrandMapper</code> 接口中定义 <code>selectByPage()</code> 方法进行分页查询，代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> begin</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> size</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Select(&quot;select * from tb_brand limit #&#123;begin&#125; , #&#123;size&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ResultMap(&quot;brandResultMap&quot;)</span></span><br><span class="line"><span class="function">List&lt;Brand&gt; <span class="title">selectByPage</span><span class="params">(<span class="meta">@Param(&quot;begin&quot;)</span> <span class="keyword">int</span> begin,<span class="meta">@Param(&quot;size&quot;)</span> <span class="keyword">int</span> size)</span></span>;</span><br></pre></td></tr></table></figure>
<p>在 <code>BrandMapper</code> 接口中定义 <code>selectTotalCount()</code> 方法进行统计记录数，代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询总记录数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Select(&quot;select count(*) from tb_brand &quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">selectTotalCount</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>
<h4 id="722-service方法实现"><a class="markdownIt-Anchor" href="#722-service方法实现"></a> 7.2.2  service方法实现</h4>
<p>在 <code>BrandService</code> 接口中定义 <code>selectByPage()</code> 分页查询数据的业务逻辑方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> currentPage  当前页码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pageSize   每页展示条数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">PageBean&lt;Brand&gt;  <span class="title">selectByPage</span><span class="params">(<span class="keyword">int</span> currentPage,<span class="keyword">int</span> pageSize)</span></span>;</span><br></pre></td></tr></table></figure>
<p>在 <code>BrandServiceImpl</code> 类中重写 <code>selectByPage()</code> 方法，并进行业务逻辑实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> PageBean&lt;Brand&gt; <span class="title">selectByPage</span><span class="params">(<span class="keyword">int</span> currentPage, <span class="keyword">int</span> pageSize)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//2. 获取SqlSession对象</span></span><br><span class="line">    SqlSession sqlSession = factory.openSession();</span><br><span class="line">    <span class="comment">//3. 获取BrandMapper</span></span><br><span class="line">    BrandMapper mapper = sqlSession.getMapper(BrandMapper.class);</span><br><span class="line">    <span class="comment">//4. 计算开始索引</span></span><br><span class="line">    <span class="keyword">int</span> begin = (currentPage - <span class="number">1</span>) * pageSize;</span><br><span class="line">    <span class="comment">// 计算查询条目数</span></span><br><span class="line">    <span class="keyword">int</span> size = pageSize;</span><br><span class="line">    <span class="comment">//5. 查询当前页数据</span></span><br><span class="line">    List&lt;Brand&gt; rows = mapper.selectByPage(begin, size);</span><br><span class="line">    <span class="comment">//6. 查询总记录数</span></span><br><span class="line">    <span class="keyword">int</span> totalCount = mapper.selectTotalCount();</span><br><span class="line">    <span class="comment">//7. 封装PageBean对象</span></span><br><span class="line">    PageBean&lt;Brand&gt; pageBean = <span class="keyword">new</span> PageBean&lt;&gt;();</span><br><span class="line">    pageBean.setRows(rows);</span><br><span class="line">    pageBean.setTotalCount(totalCount);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//8. 释放资源</span></span><br><span class="line">    sqlSession.close();</span><br><span class="line">    <span class="keyword">return</span> pageBean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="723-servlet实现"><a class="markdownIt-Anchor" href="#723-servlet实现"></a> 7.2.3  servlet实现</h4>
<p>在 <code>BrandServlet</code> 类中定义 <code>selectByPage()</code>  方法。而该方法的逻辑如下：</p>
<ul>
<li>获取页面提交的 <code>当前页码</code> 和 <code>每页显示条目数</code> 两个数据。这两个参数是在url后进行拼接的，格式是  <code>url?currentPage=1&amp;pageSize=5</code>。获取这样的参数需要使用 <code>requet.getparameter()</code> 方法获取。</li>
<li>调用 service 的 <code>selectByPage()</code> 方法进行分页查询的业务逻辑处理</li>
<li>将查询到的数据转换为 json 格式的数据</li>
<li>响应 json 数据</li>
</ul>
<p>servlet 中 <code>selectByPage()</code> 方法代码实现如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">selectByPage</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    <span class="comment">//1. 接收 当前页码 和 每页展示条数    url?currentPage=1&amp;pageSize=5</span></span><br><span class="line">    String _currentPage = request.getParameter(<span class="string">&quot;currentPage&quot;</span>);</span><br><span class="line">    String _pageSize = request.getParameter(<span class="string">&quot;pageSize&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> currentPage = Integer.parseInt(_currentPage);</span><br><span class="line">    <span class="keyword">int</span> pageSize = Integer.parseInt(_pageSize);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2. 调用service查询</span></span><br><span class="line">    PageBean&lt;Brand&gt; pageBean = brandService.selectByPage(currentPage, pageSize);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2. 转为JSON</span></span><br><span class="line">    String jsonString = JSON.toJSONString(pageBean);</span><br><span class="line">    <span class="comment">//3. 写数据</span></span><br><span class="line">    response.setContentType(<span class="string">&quot;text/json;charset=utf-8&quot;</span>);</span><br><span class="line">    response.getWriter().write(jsonString);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="724-测试"><a class="markdownIt-Anchor" href="#724-测试"></a> 7.2.4  测试</h4>
<p>在浏览器上地址栏输入 <code>http://localhost:8080/brand-case/brand/selectByPage?currentPage=1&amp;pageSize=5</code> ，查询到以下数据</p>
<p><img src="assets/image-20210828184610060.png" alt="image-20210828184610060" /></p>
<h3 id="73-前端实现"><a class="markdownIt-Anchor" href="#73-前端实现"></a> 7.3  前端实现</h3>
<h4 id="731-selectall-代码改进"><a class="markdownIt-Anchor" href="#731-selectall-代码改进"></a> 7.3.1  selectAll 代码改进</h4>
<p><code>selectAll()</code> 函数之前是查询所有数据，现需要改成分页查询。 请求路径应改为 <code>http://localhost:8080/brand-case/brand/selectByPage?currentPage=1&amp;pageSize=5</code> ，而 <code>currentPage</code>  和 <code>pageSize</code>  是需要携带的参数，分别是 当前页码 和 每页显示的条目数。</p>
<p>刚才我们对后端代码进行测试可以看出响应回来的数据，所以在异步请求的成功回调函数（<code>then</code> 中的匿名函数）中给页面表格的数据模型赋值 <code>_this.tableData = resp.data.rows;</code>。整体代码如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _this = <span class="built_in">this</span>;</span><br><span class="line">axios(&#123;</span><br><span class="line">    <span class="attr">method</span>:<span class="string">&quot;post&quot;</span>,</span><br><span class="line">    <span class="attr">url</span>:<span class="string">&quot;http://localhost:8080/brand-case/brand/selectByPage？currentPage=1&amp;pageSize=5&quot;</span></span><br><span class="line">&#125;).then(<span class="function"><span class="params">resp</span> =&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//设置表格数据</span></span><br><span class="line">    _this.tableData = resp.data.rows; <span class="comment">// &#123;rows:[],totalCount:100&#125;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>响应的数据中还有总记录数，要进行总记录数展示需要在页面绑定数据模型</p>
<img src="assets/image-20210828185553407.png" alt="image-20210828185553407" style="zoom:70%;" />
<blockquote>
<p><mark>注意：该数据模型需要在Vue对象中声明出来。</mark></p>
</blockquote>
<p>那异步请求的代码就可以优化为</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _this = <span class="built_in">this</span>;</span><br><span class="line">axios(&#123;</span><br><span class="line">    <span class="attr">method</span>:<span class="string">&quot;post&quot;</span>,</span><br><span class="line">    <span class="attr">url</span>:<span class="string">&quot;http://localhost:8080/brand-case/brand/selectByPage?currentPage=1&amp;pageSize=5&quot;</span></span><br><span class="line">&#125;).then(<span class="function"><span class="params">resp</span> =&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//设置表格数据</span></span><br><span class="line">    _this.tableData = resp.data.rows; <span class="comment">// &#123;rows:[],totalCount:100&#125;</span></span><br><span class="line">    <span class="comment">//设置总记录数</span></span><br><span class="line">    _this.totalCount = resp.data.totalCount;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>而页面中分页组件给 <code>当前页码</code> 和 <code>每页显示的条目数</code> 都绑定了数据模型</p>
<img src="assets/image-20210828191752872.png" alt="image-20210828191752872" style="zoom:80%;" />
<p>所以 <code>selectAll()</code> 函数中发送异步请求的资源路径中不能将当前页码和 每页显示条目数写死，代码就可以优化为</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _this = <span class="built_in">this</span>;</span><br><span class="line">axios(&#123;</span><br><span class="line">    <span class="attr">method</span>:<span class="string">&quot;post&quot;</span>,</span><br><span class="line">    <span class="attr">url</span>:<span class="string">&quot;http://localhost:8080/brand-case/brand/selectByPage?currentPage=&quot;</span>+<span class="built_in">this</span>.currentPage+<span class="string">&quot;&amp;pageSize=&quot;</span> + <span class="built_in">this</span>.pageSize</span><br><span class="line">&#125;).then(<span class="function"><span class="params">resp</span> =&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//设置表格数据</span></span><br><span class="line">    _this.tableData = resp.data.rows; <span class="comment">// &#123;rows:[],totalCount:100&#125;</span></span><br><span class="line">    <span class="comment">//设置总记录数</span></span><br><span class="line">    _this.totalCount = resp.data.totalCount;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="732-改变每页条目数"><a class="markdownIt-Anchor" href="#732-改变每页条目数"></a> 7.3.2  改变每页条目数</h4>
<img src="assets/image-20210828192937340.png" alt="image-20210828192937340" style="zoom:80%;" />
<p>当我们改变每页显示的条目数后，需要重新发送异步请求。而下图是分页组件代码，<code>@size-change</code> 就是每页显示的条目数发生变化时会触发的事件</p>
<img src="assets/image-20210828193143116.png" alt="image-20210828193143116" style="zoom:80%;" />
<p>而该事件绑定了一个 <code>handleSizeChange</code> 函数，整个逻辑如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">handleSizeChange</span>(<span class="params">val</span>)</span> &#123; <span class="comment">//我们选择的是 ‘5条/页’ 此值就是 5.而我们选择了 `10条/页` 此值就是 10</span></span><br><span class="line">    <span class="comment">// 重新设置每页显示的条数</span></span><br><span class="line">    <span class="built_in">this</span>.pageSize  = val; </span><br><span class="line">    <span class="comment">//调用 selectAll 函数重新分页查询数据</span></span><br><span class="line">    <span class="built_in">this</span>.selectAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="733-改变当前页码"><a class="markdownIt-Anchor" href="#733-改变当前页码"></a> 7.3.3  改变当前页码</h4>
<p>当我们改变页码时，需要重新发送异步请求。而下图是分页组件代码，<code>@current-change</code> 就是页码发生变化时会触发的事件</p>
<img src="assets/image-20210828193713913.png" alt="image-20210828193713913" style="zoom:80%;" />
<p>而该事件绑定了一个 <code>handleSizeChange</code> 函数，整个逻辑如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">handleCurrentChange</span>(<span class="params">val</span>)</span> &#123; <span class="comment">//val 就是改变后的页码</span></span><br><span class="line">    <span class="comment">// 重新设置当前页码</span></span><br><span class="line">    <span class="built_in">this</span>.currentPage  = val;</span><br><span class="line">    <span class="comment">//调用 selectAll 函数重新分页查询数据</span></span><br><span class="line">    <span class="built_in">this</span>.selectAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="8条件查询"><a class="markdownIt-Anchor" href="#8条件查询"></a> 8，条件查询</h2>
<img src="assets/image-20210828212019663.png" alt="image-20210828212019663" style="zoom:60%;" />
<p>上图就是用来输入条件查询的条件数据的。要做条件查询功能，先明确以下三个问题</p>
<ul>
<li>
<p>3个条件之间什么关系？</p>
<p>同时满足，所用 SQL 中多个条件需要使用 and 关键字连接</p>
</li>
<li>
<p>3个条件必须全部填写吗？</p>
<p>不需要。想根据哪儿个条件查询就写那个，所以这里需要使用动态 sql 语句</p>
</li>
<li>
<p>条件查询需要分页吗？</p>
<p>需要</p>
</li>
</ul>
<p>根据上面三个问题的明确，我们就可以确定sql语句了：</p>
<img src="assets/image-20210828213116559.png" alt="image-20210828213116559" style="zoom:70%;" /> 
<p>整个条件分页查询流程如下</p>
<p><img src="assets/image-20210828224859135.png" alt="image-20210828224859135" /></p>
<h3 id="81-后端实现"><a class="markdownIt-Anchor" href="#81-后端实现"></a> 8.1  后端实现</h3>
<h4 id="811-dao实现"><a class="markdownIt-Anchor" href="#811-dao实现"></a> 8.1.1  dao实现</h4>
<p>在 <code>BrandMapper</code> 接口中定义 <code>selectByPageAndCondition()</code> 方法 和 <code>selectTotalCountByCondition</code> 方法，用来进行条件分页查询功能，方法如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页条件查询</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> begin</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> size</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="function">List&lt;Brand&gt; <span class="title">selectByPageAndCondition</span><span class="params">(<span class="meta">@Param(&quot;begin&quot;)</span> <span class="keyword">int</span> begin,<span class="meta">@Param(&quot;size&quot;)</span> <span class="keyword">int</span> size,<span class="meta">@Param(&quot;brand&quot;)</span> Brand brand)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据条件查询总记录数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">selectTotalCountByCondition</span><span class="params">(Brand brand)</span></span>;</span><br></pre></td></tr></table></figure>
<p>参数：</p>
<ul>
<li><code>begin</code> 分页查询的起始索引</li>
<li><code>size</code> 分页查询的每页条目数</li>
<li><code>brand</code> 用来封装条件的对象</li>
</ul>
<p>由于这是一个复杂的查询语句，需要使用动态sql；所以我们在映射配置文件中书写 sql 语句。<code>brand_name</code> 字段和 <code>company_name</code> 字段需要进行模糊查询，所以需要使用 <code>%</code> 占位符。映射配置文件中 statement 书写如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--查询满足条件的数据并进行分页--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByPageAndCondition&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;brandResultMap&quot;</span>&gt;</span></span><br><span class="line">    select *</span><br><span class="line">    from tb_brand</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;brand.brandName != null and brand.brandName != &#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">            and  brand_name like #&#123;brand.brandName&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;brand.companyName != null and brand.companyName != &#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">            and  company_name like #&#123;brand.companyName&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;brand.status != null&quot;</span>&gt;</span></span><br><span class="line">            and  status = #&#123;brand.status&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    limit #&#123;begin&#125; , #&#123;size&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--查询满足条件的数据条目数--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectTotalCountByCondition&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.Integer&quot;</span>&gt;</span></span><br><span class="line">    select count(*)</span><br><span class="line">    from tb_brand</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;brandName != null and brandName != &#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">            and  brand_name like #&#123;brandName&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;companyName != null and companyName != &#x27;&#x27; &quot;</span>&gt;</span></span><br><span class="line">            and  company_name like #&#123;companyName&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;status != null&quot;</span>&gt;</span></span><br><span class="line">            and  status = #&#123;status&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="812-service实现"><a class="markdownIt-Anchor" href="#812-service实现"></a> 8.1.2  service实现</h4>
<p>在 <code>BrandService</code> 接口中定义 <code>selectByPageAndCondition()</code> 分页查询数据的业务逻辑方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页条件查询</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> currentPage</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pageSize</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> brand</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="function">PageBean&lt;Brand&gt;  <span class="title">selectByPageAndCondition</span><span class="params">(<span class="keyword">int</span> currentPage,<span class="keyword">int</span> pageSize,Brand brand)</span></span>;</span><br></pre></td></tr></table></figure>
<p>在 <code>BrandServiceImpl</code> 类中重写 <code>selectByPageAndCondition()</code> 方法，并进行业务逻辑实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> PageBean&lt;Brand&gt; <span class="title">selectByPageAndCondition</span><span class="params">(<span class="keyword">int</span> currentPage, <span class="keyword">int</span> pageSize, Brand brand)</span> </span>&#123;</span><br><span class="line">       <span class="comment">//2. 获取SqlSession对象</span></span><br><span class="line">       SqlSession sqlSession = factory.openSession();</span><br><span class="line">       <span class="comment">//3. 获取BrandMapper</span></span><br><span class="line">       BrandMapper mapper = sqlSession.getMapper(BrandMapper.class);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       <span class="comment">//4. 计算开始索引</span></span><br><span class="line">       <span class="keyword">int</span> begin = (currentPage - <span class="number">1</span>) * pageSize;</span><br><span class="line">       <span class="comment">// 计算查询条目数</span></span><br><span class="line">       <span class="keyword">int</span> size = pageSize;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// 处理brand条件，模糊表达式</span></span><br><span class="line">       String brandName = brand.getBrandName();</span><br><span class="line">       <span class="keyword">if</span> (brandName != <span class="keyword">null</span> &amp;&amp; brandName.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">           brand.setBrandName(<span class="string">&quot;%&quot;</span> + brandName + <span class="string">&quot;%&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       String companyName = brand.getCompanyName();</span><br><span class="line">       <span class="keyword">if</span> (companyName != <span class="keyword">null</span> &amp;&amp; companyName.length() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">           brand.setCompanyName(<span class="string">&quot;%&quot;</span> + companyName + <span class="string">&quot;%&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//5. 查询当前页数据</span></span><br><span class="line">       List&lt;Brand&gt; rows = mapper.selectByPageAndCondition(begin, size, brand);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//6. 查询总记录数</span></span><br><span class="line">       <span class="keyword">int</span> totalCount = mapper.selectTotalCountByCondition(brand);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//7. 封装PageBean对象</span></span><br><span class="line">       PageBean&lt;Brand&gt; pageBean = <span class="keyword">new</span> PageBean&lt;&gt;();</span><br><span class="line">       pageBean.setRows(rows);</span><br><span class="line">       pageBean.setTotalCount(totalCount);</span><br><span class="line"></span><br><span class="line">       <span class="comment">//8. 释放资源</span></span><br><span class="line">       sqlSession.close();</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> pageBean;</span><br><span class="line">   </span><br></pre></td></tr></table></figure>
<blockquote>
<p><mark>注意：brandName 和 companyName 属性值到时候需要进行模糊查询，所以前后需要拼接上 <code>%</code></mark>。</p>
</blockquote>
<h4 id="813-servlet实现"><a class="markdownIt-Anchor" href="#813-servlet实现"></a> 8.1.3  servlet实现</h4>
<p>在 <code>BrandServlet</code> 类中定义 <code>selectByPageAndCondition()</code>  方法。而该方法的逻辑如下：</p>
<ul>
<li>
<p>获取页面提交的 <code>当前页码</code> 和 <code>每页显示条目数</code> 两个数据。这两个参数是在url后进行拼接的，格式是  <code>url?currentPage=1&amp;pageSize=5</code>。获取这样的参数需要使用 <code>requet.getparameter()</code> 方法获取。</p>
</li>
<li>
<p>获取页面提交的 <code>条件数据</code> ，并将数据封装到一个Brand对象中。由于这部分数据到时候是需要以 json 格式进行提交的，所以我们需要通过流获取数据，具体代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取查询条件对象</span></span><br><span class="line">BufferedReader br = request.getReader();</span><br><span class="line">String params = br.readLine();<span class="comment">//json字符串</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//转为 Brand</span></span><br><span class="line">Brand brand = JSON.parseObject(params, Brand.class);</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>调用 service 的 <code>selectByPageAndCondition()</code> 方法进行分页查询的业务逻辑处理</p>
</li>
<li>
<p>将查询到的数据转换为 json 格式的数据</p>
</li>
<li>
<p>响应 json 数据</p>
</li>
</ul>
<p>servlet 中 <code>selectByPageAndCondition()</code> 方法代码实现如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页条件查询</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ServletException</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">selectByPageAndCondition</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    <span class="comment">//1. 接收 当前页码 和 每页展示条数    url?currentPage=1&amp;pageSize=5</span></span><br><span class="line">    String _currentPage = request.getParameter(<span class="string">&quot;currentPage&quot;</span>);</span><br><span class="line">    String _pageSize = request.getParameter(<span class="string">&quot;pageSize&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> currentPage = Integer.parseInt(_currentPage);</span><br><span class="line">    <span class="keyword">int</span> pageSize = Integer.parseInt(_pageSize);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取查询条件对象</span></span><br><span class="line">    BufferedReader br = request.getReader();</span><br><span class="line">    String params = br.readLine();<span class="comment">//json字符串</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//转为 Brand</span></span><br><span class="line">    Brand brand = JSON.parseObject(params, Brand.class);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//2. 调用service查询</span></span><br><span class="line">    PageBean&lt;Brand&gt; pageBean = brandService.selectByPageAndCondition(currentPage,pageSize,brand);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2. 转为JSON</span></span><br><span class="line">    String jsonString = JSON.toJSONString(pageBean);</span><br><span class="line">    <span class="comment">//3. 写数据</span></span><br><span class="line">    response.setContentType(<span class="string">&quot;text/json;charset=utf-8&quot;</span>);</span><br><span class="line">    response.getWriter().write(jsonString);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="82-前端实现"><a class="markdownIt-Anchor" href="#82-前端实现"></a> 8.2  前端实现</h3>
<p>前端代码我们从以下几方面实现：</p>
<ol>
<li>
<p><strong>查询表单绑定查询条件对象模型</strong></p>
<p>这一步在页面上已经实现了，页面代码如下：</p>
<img src="assets/image-20210828223817324.png" alt="image-20210828223817324" style="zoom:70%;" />
</li>
<li>
<p><strong>点击查询按钮查询数据</strong></p>
<img src="assets/image-20210828223952142.png" alt="image-20210828223952142" style="zoom:67%;" />
<p>从上面页面可以看到给 <code>查询</code> 按钮绑定了 <code>onSubmit()</code> 函数，而在 <code>onSubmit()</code> 函数中只需要调用 <code>selectAll()</code> 函数进行条件分页查询。</p>
</li>
<li>
<p><strong>改进 selectAll() 函数</strong></p>
<p>子页面加载完成后发送异步请求，需要携带当前页码、每页显示条数、查询条件对象。接下来先对携带的数据进行说明：</p>
<ul>
<li><code>当前页码</code> 和 <code>每页显示条数</code> 这两个参数我们会拼接到 URL 的后面</li>
<li><code>查询条件对象</code> 这个参数需要以 json 格式提交给后端程序</li>
</ul>
<p>修改 <code>selectAll()</code> 函数逻辑为</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _this = <span class="built_in">this</span>;</span><br><span class="line"></span><br><span class="line">axios(&#123;</span><br><span class="line">    <span class="attr">method</span>:<span class="string">&quot;post&quot;</span>,</span><br><span class="line">    <span class="attr">url</span>:<span class="string">&quot;http://localhost:8080/brand-case/brand/selectByPageAndCondition?currentPage=&quot;</span>+<span class="built_in">this</span>.currentPage+<span class="string">&quot;&amp;pageSize=&quot;</span>+<span class="built_in">this</span>.pageSize,</span><br><span class="line">    <span class="attr">data</span>:<span class="built_in">this</span>.brand</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">resp</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置表格数据</span></span><br><span class="line">    _this.tableData = resp.data.rows; <span class="comment">// &#123;rows:[],totalCount:100&#125;</span></span><br><span class="line">    <span class="comment">//设置总记录数</span></span><br><span class="line">    _this.totalCount = resp.data.totalCount;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="9前端代码优化"><a class="markdownIt-Anchor" href="#9前端代码优化"></a> 9，前端代码优化</h2>
<p>咱们已经将所有的功能实现完毕。而针对前端代码中的发送异步请求的代码，如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _this = <span class="built_in">this</span>;</span><br><span class="line"></span><br><span class="line">axios(&#123;</span><br><span class="line">    <span class="attr">method</span>:<span class="string">&quot;post&quot;</span>,</span><br><span class="line">    <span class="attr">url</span>:<span class="string">&quot;http://localhost:8080/brand-case/brand/selectByPageAndCondition?currentPage=&quot;</span>+<span class="built_in">this</span>.currentPage+<span class="string">&quot;&amp;pageSize=&quot;</span>+<span class="built_in">this</span>.pageSize,</span><br><span class="line">    <span class="attr">data</span>:<span class="built_in">this</span>.brand</span><br><span class="line">&#125;).then(<span class="function"><span class="keyword">function</span> (<span class="params">resp</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置表格数据</span></span><br><span class="line">    _this.tableData = resp.data.rows; <span class="comment">// &#123;rows:[],totalCount:100&#125;</span></span><br><span class="line">    <span class="comment">//设置总记录数</span></span><br><span class="line">    _this.totalCount = resp.data.totalCount;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>需要在成功的回调函数（也就是<code>then</code> 函数中的匿名函数）中使用this，都需要在外边使用 <code>_this</code> 记录一下 <code>this</code> 所指向的对象；因为在外边的 <code>this</code> 表示的是 Vue 对象，而回调函数中的 <code>this</code> 表示的不是 vue 对象。这里我们可以使用 <code>ECMAScript6</code> 中的新语法（箭头函数）来简化这部分代码，如上面的代码可以简化为:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">axios(&#123;</span><br><span class="line">    <span class="attr">method</span>:<span class="string">&quot;post&quot;</span>,</span><br><span class="line">    <span class="attr">url</span>:<span class="string">&quot;http://localhost:8080/brand-case/brand/selectByPageAndCondition?currentPage=&quot;</span>+<span class="built_in">this</span>.currentPage+<span class="string">&quot;&amp;pageSize=&quot;</span>+<span class="built_in">this</span>.pageSize,</span><br><span class="line">    <span class="attr">data</span>:<span class="built_in">this</span>.brand</span><br><span class="line">&#125;).then(<span class="function">(<span class="params">resp</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置表格数据</span></span><br><span class="line">    <span class="built_in">this</span>.tableData = resp.data.rows; <span class="comment">// &#123;rows:[],totalCount:100&#125;</span></span><br><span class="line">    <span class="comment">//设置总记录数</span></span><br><span class="line">    <span class="built_in">this</span>.totalCount = resp.data.totalCount;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><strong>箭头函数语法：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(参数) =&gt; &#123;</span><br><span class="line">	逻辑代码</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>箭头函数的作用：</strong></p>
<p>替换（简化）匿名函数。</p>
<blockquote>
<p>来源：it 黑马 JavaWeb 教程</p>
</blockquote>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="http://littlewuuu.com/2022/08/22/%E9%BB%91%E9%A9%AC/14-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/" title="FinalCase" target="_blank" rel="external">http://littlewuuu.com/2022/08/22/黑马/14-综合案例/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/littlewuuu" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/meee.jpg" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/littlewuuu" target="_blank"><span class="text-dark">Wuuu</span><small class="ml-1x"></small></a></h3>
        <div>smile:)</div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    
  <section id="comments">
  	
  </section>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2022/08/22/%E9%BB%91%E9%A9%AC/5-MybatisExercise/" title="MybatisExercise"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;Newer</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2022/08/22/%E9%BB%91%E9%A9%AC/6-HTML/" title="HTML"><span>Older&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
    <li class="toggle-toc">
      <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="Catalogue" role="button">
        <span>[&nbsp;</span><span>Catalogue</span>
        <i class="text-collapsed icon icon-anchor"></i>
        <i class="text-in icon icon-close"></i>
        <span>]</span>
      </a>
    </li>
    
  </ul>
  
  
  
  <div class="bar-right">
    
  </div>
  </div>
</nav>
  


</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
    <div class="copyright">
    	
        <div class="publishby">
        	Theme by <a href="https://github.com/cofess" target="_blank"> cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.
        </div>
    </div>
</footer>
  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>






   




   


  <script src="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.3.5/dist/jquery.fancybox.min.js"></script>
  <script>
  //利用 FancyBox 实现点击图片放大
  $(document).ready(function() {
    $('article img').not('[hidden]').not('.panel-body img').each(function() {
      var $image = $(this);
      var imageCaption = $image.attr('alt');
      var $imageWrapLink = $image.parent('a');
      if ($imageWrapLink.length < 1) {
        var src = this.getAttribute('src');
        var idx = src.lastIndexOf('?');
        if (idx != -1) {
          src = src.substring(0, idx);
        }
        $imageWrapLink = $image.wrap('<a href="' + src + '"></a>').parent('a');
      }
      $imageWrapLink.attr('data-fancybox', 'images');
      if (imageCaption) {
        $imageWrapLink.attr('data-caption', imageCaption);
      }
    });
    $().fancybox({
      selector: '[data-fancybox="images"]',
      hash: false,
      loop: false,
    });
  });
  </script>





</body>
</html>